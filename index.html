<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Maniek ‚Äî Pewny Przew√≥z</title>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<style>
  :root{
    --bg-deep:#0f1724;
    --card:#172433;
    --accent:#4FA3FF;
    --accent-2:#DAA520;
    --muted:#9fb3d6;
    --white:#ffffff;
  }

  *{box-sizing:border-box; margin:0; padding:0;}
  body{
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg, rgba(11,19,33,0.94) 0%, rgba(9,13,22,0.92) 100%), url('https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat fixed;
    color:var(--white);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding-bottom:60px;
    min-height:100vh;
  }

  header{
    background: rgba(27,42,65,0.95);
    border-bottom: 1px solid rgba(79,163,255,0.08);
    padding:12px 16px;
    position:sticky;
    top:0;
    z-index:100;
    backdrop-filter: blur(10px);
  }
  
  .container{ 
    max-width:1100px; 
    margin:0 auto; 
    padding:0 16px; 
    width:100%;
  }
  
  .brand{ 
    display:flex; 
    align-items:center; 
    gap:10px; 
    flex-wrap:wrap;
  }
  
  .logo {
    width:44px;
    height:44px;
    border-radius:8px;
    background:linear-gradient(135deg,var(--accent),#2b6ce3);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#0b1724;
    box-shadow:0 3px 14px rgba(11,19,33,0.5);
    flex-shrink:0;
  }
  
  .brand h1{ 
    margin:0; 
    font-size:clamp(14px, 4vw, 16px);
    line-height:1.2;
  }
  
  .brand p{ 
    margin:0;
    font-size:clamp(10px, 3vw, 12px);
    color:var(--muted);
    width:100%;
  }

  nav{ 
    margin-left:auto; 
    display:flex; 
    gap:8px; 
    align-items:center;
    flex-wrap:wrap;
  }
  
  .btn {
    background:transparent;
    border:1px solid rgba(255,255,255,0.06); 
    color:var(--white);
    padding:6px 10px;
    border-radius:6px;
    font-weight:600;
    cursor:pointer;
    text-decoration:none;
    font-size:12px;
    white-space:nowrap;
    transition: all 0.3s ease;
  }
  
  .btn:hover {
    background: rgba(255,255,255,0.05);
  }
  
  .btn.primary{ 
    background:var(--accent); 
    color:#072033; 
    border:none; 
  }
  
  .btn.primary:hover {
    background: #3a8de6;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79,163,255,0.3);
  }
  
  .btn.ghost{ background:transparent; }

  main{ 
    padding:20px 0;
    min-height:calc(100vh - 200px);
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr;
    gap:16px;
    align-items:start;
  }

  @media (min-width: 768px) {
    .grid{ 
      grid-template-columns: 1fr 360px;
      gap:20px;
    }
    
    .brand p{
      width:auto;
    }
    
    .btn {
      padding:8px 12px;
      font-size:14px;
    }
    
    header {
      padding:16px;
    }
  }

  @media (max-width: 480px) {
    nav{ 
      display:none; 
    }
    
    .brand {
      justify-content:center;
      text-align:center;
    }
  }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:16px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    border:1px solid rgba(255,255,255,0.03);
    width:100%;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(2,6,23,0.8);
  }

  h2{ 
    margin:0 0 10px 0; 
    color:var(--accent); 
    font-size:clamp(16px, 4vw, 18px);
  }
  
  label{ 
    display:block; 
    font-size:13px; 
    color:var(--muted); 
    margin-bottom:6px; 
  }
  
  input[type=text], input[type=email], input[type=tel], input[type=datetime-local], textarea, select, input[type=number]{
    width:100%; 
    padding:10px 12px; 
    border-radius:8px; 
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02); 
    color:var(--white); 
    outline:none; 
    font-size:14px;
    min-height:44px;
    transition: border 0.3s ease;
  }
  
  input:focus, textarea:focus, select:focus {
    border-color: var(--accent);
  }
  
  textarea{ 
    min-height:90px; 
    resize:vertical; 
  }

  .form-row{ 
    display:flex; 
    flex-direction:column;
    gap:10px; 
  }
  
  .form-row .col{ 
    flex:1; 
    width:100%;
  }

  @media (min-width: 480px) {
    .form-row{
      flex-direction:row;
    }
  }

  .submit {
    display:inline-block;
    padding:12px 16px;
    border-radius:10px;
    border:none;
    background:linear-gradient(90deg,var(--accent),#2b6ce3);
    color:#021224;
    font-weight:700;
    cursor:pointer;
    margin-top:8px;
    font-size:14px;
    min-height:44px;
    width:100%;
    transition: all 0.3s ease;
  }

  .submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(79,163,255,0.4);
  }

  @media (min-width: 480px) {
    .submit {
      width:auto;
    }
  }

  .muted{ color:var(--muted); font-size:13px; margin-top:8px; }

  .panel-title{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
  table{ width:100%; border-collapse:collapse; margin-top:12px; font-size:14px; overflow-x:auto; display:block; }
  th,td{ padding:8px 10px; border-bottom:1px dashed rgba(255,255,255,0.04); text-align:left; white-space:nowrap; }
  th{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:0.6px; }

  .chip{ background:rgba(255,255,255,0.03); padding:6px 10px; border-radius:999px; font-size:13px; display:inline-block; color:var(--muted); }

  .icons-row{ 
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap:10px;
    justify-content:center;
    margin:14px 0;
  }
  
  .icon-box{ 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    gap:6px; 
    padding:12px; 
    border-radius:10px; 
    background:rgba(255,255,255,0.02); 
    text-align:center;
    min-height:80px;
    transition: transform 0.3s ease, background 0.3s ease;
  }
  
  .icon-box:hover {
    transform: translateY(-5px);
    background: rgba(255,255,255,0.05);
  }
  
  .icon-emoji{ font-size:24px; }

  footer{ 
    text-align:center; 
    color:var(--muted); 
    padding:20px 8px; 
    margin-top:20px; 
    font-size:13px;
  }
  
  .small{ font-size:13px;color:var(--muted); }

  .opinie{ font-style:italic; opacity:0.95; font-size:15px; line-height:1.4; }
  .opinie-wrap{ display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap; }

  .ribbon{ 
    position:fixed; 
    right:10px; 
    bottom:70px; 
    background:var(--accent-2); 
    color:#072033; 
    padding:8px 12px; 
    border-radius:999px; 
    font-weight:700; 
    box-shadow:0 6px 18px rgba(10,14,25,0.6); 
    z-index:60;
    font-size:12px;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  .hidden { display: none !important; }
  
  #rules {
    background: var(--card) !important;
    border-top: 1px solid rgba(255,255,255,0.05);
    margin-top: 30px;
    padding:20px 0;
  }
  
  #rules .max-w-5xl {
    max-width: 1100px;
    margin: 0 auto;
    padding:0 16px;
  }
  
  #rules h2, #rules h3 {
    color: var(--accent);
    font-size:clamp(20px, 5vw, 24px);
  }
  
  #rules h3 {
    font-size:clamp(18px, 4vw, 20px);
  }
  
  #rules p {
    color: var(--muted);
    line-height: 1.6;
    font-size:14px;
    margin-bottom:12px;
  }
  
  .lang-flag {
    border-radius: 3px;
    transition: transform 0.2s;
    width:32px;
    height:24px;
    cursor:pointer;
  }
  
  .lang-flag:hover {
    transform: scale(1.1);
  }
  
  #partners {
    background: rgba(11,19,33,0.95) !important;
    border-top: 1px solid rgba(255,255,255,0.05);
    padding:30px 0;
  }
  
  #partners .max-w-6xl {
    max-width: 1100px;
    margin: 0 auto;
    padding:0 16px;
  }
  
  #partners h2 {
    color: var(--accent);
    text-align: center;
    margin-bottom: 20px;
    font-size:clamp(20px, 5vw, 24px);
  }
  
  #partners p {
    color: var(--muted);
    text-align: center;
    margin-bottom: 25px;
    font-size:14px;
  }
  
  .grid-cols-2 {
    grid-template-columns: repeat(2, 1fr);
    gap:15px;
  }
  
  .place-items-center {
    place-items: center;
  }
  
  .bg-gray-50 {
    background: rgba(255,255,255,0.03);
  }
  
  .rounded-lg {
    border-radius: 12px;
  }
  
  .shadow {
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  
  .hover-shadow-lg:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }
  
  .transition {
    transition: all 0.3s ease;
  }
  
  .cursor-pointer {
    cursor: pointer;
  }
  
  .p-4 {
    padding: 1rem;
  }
  
  @media (min-width: 768px) {
    .md-grid-cols-4 {
      grid-template-columns: repeat(4, 1fr);
      gap:25px;
    }
    
    #rules {
      padding:30px 0;
    }
    
    #partners {
      padding:40px 0;
    }
  }

  /* POPRAWIONY CZATBOT - RESPONSYWNY */
  .chatbot-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
  }

  .chatbot-toggle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), #2b6ce3);
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1001;
    transition: all 0.3s ease;
  }

  .chatbot-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 25px rgba(0,0,0,0.4);
  }

  .chatbot-window {
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 350px;
    height: 500px;
    background: var(--card);
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255,0.1);
    display: none;
    flex-direction: column;
    z-index: 1002;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .chatbot-header {
    background: rgba(27,42,65,0.95);
    padding: 15px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 15px 15px 0 0;
  }

  .chatbot-title {
    font-weight: bold;
    color: var(--accent);
  }

  .chatbot-close {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 20px;
    transition: color 0.3s ease;
  }

  .chatbot-close:hover {
    color: var(--white);
  }

  .chatbot-messages {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .message {
    max-width: 80%;
    padding: 10px 15px;
    border-radius: 15px;
    line-height: 1.4;
    font-size: 14px;
    word-wrap: break-word;
    animation: messageAppear 0.3s ease;
  }

  @keyframes messageAppear {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .message.user {
    align-self: flex-end;
    background: var(--accent);
    color: #072033;
    border-bottom-right-radius: 5px;
  }

  .message.bot {
    align-self: flex-start;
    background: rgba(255,255,255,0.05);
    color: var(--white);
    border-bottom-left-radius: 5px;
  }

  .chatbot-input {
    display: flex;
    padding: 15px;
    border-top: 1px solid rgba(255,255,255,0.1);
    gap: 10px;
  }

  .chatbot-input input {
    flex: 1;
    padding: 12px 15px;
    border-radius: 25px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.05);
    color: var(--white);
    outline: none;
    font-size: 14px;
  }

  .chatbot-send {
    background: var(--accent);
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    color: #072033;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .chatbot-send:hover {
    background: #3a8de6;
    transform: scale(1.05);
  }

  .typing-indicator {
    display: none;
    align-self: flex-start;
    background: rgba(255,255,255,0.05);
    padding: 10px 15px;
    border-radius: 15px;
    border-bottom-left-radius: 5px;
    color: var(--muted);
    font-style: italic;
  }

  .quick-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
  }

  .quick-action {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--muted);
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .quick-action:hover {
    background: var(--accent);
    color: #072033;
  }

  /* RESPONSYWNO≈öƒÜ CZATBOTA */
  @media (max-width: 480px) {
    .chatbot-container {
      bottom: 10px;
      right: 10px;
      left: 10px;
    }
    
    .chatbot-toggle {
      width: 50px;
      height: 50px;
      font-size: 20px;
      right: 10px;
      bottom: 10px;
    }
    
    .chatbot-window {
      width: calc(100vw - 20px);
      right: 10px;
      left: 10px;
      bottom: 70px;
      height: 60vh;
      min-height: 400px;
      max-height: 500px;
    }
    
    .message {
      max-width: 85%;
      font-size: 14px;
    }
    
    .quick-actions {
      gap: 5px;
    }
    
    .quick-action {
      font-size: 11px;
      padding: 5px 10px;
    }
  }

  /* POPRAWIONA MAPA */
  #mapContainer {
    height: 320px;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    background: var(--card);
  }

  #osmMap {
    width: 100%;
    height: 100%;
  }

  .leaflet-container {
    background: var(--card) !important;
    font-family: inherit !important;
  }

  .address-search {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }
  
  .address-search input {
    flex: 1;
  }
  
  .map-controls {
    margin-bottom: 10px;
  }

  @media (max-width: 480px) {
    .address-search {
      flex-direction: column;
    }
    
    #mapContainer {
      height: 280px;
    }
  }

  .welcome-message {
    background: linear-gradient(135deg, var(--accent), #2b6ce3);
    color: #072033;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    animation: fadeIn 0.5s ease;
  }

  .form-error {
    color: #ff6b6b;
    font-size: 12px;
    margin-top: 4px;
    display: none;
  }

  .success-message {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    text-align: center;
    animation: fadeIn 0.5s ease;
  }

  .loading {
    opacity: 0.7;
    pointer-events: none;
  }
</style>
</head>
<body>

<header>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
    <div class="brand">
      <div class="logo">MP</div>
      <div>
        <h1>Maniek ‚Äî Pewny Przew√≥z</h1>
        <p>Bezpiecznie. Na czas. Zawsze.</p>
      </div>
    </div>

    <nav>
      <a class="btn" href="#kierowca">O kierowcy</a>
      <a class="btn" href="#bezpieczenstwo">Bezpiecze≈Ñstwo</a>
      <a class="btn" href="#opinie">Opinie</a>
      <a class="btn primary" id="openPanelBtn">Panel kierowcy</a>
    </nav>
  </div>
</header>

<main class="container">
  <div class="grid">
    <div>
      <div class="card">
        <h2>Zarezerwuj przejazd</h2>
        <p class="small muted">Wype≈Çnij formularz ‚Äî Maniek potwierdzi telefonicznie.</p>

        <form id="bookingForm" autocomplete="off">
          <div style="margin-top:12px;">
            <label for="name">Imiƒô i nazwisko</label>
            <input id="name" type="text" required placeholder="Jan Kowalski">
            <div class="form-error" id="nameError">Proszƒô podaƒá imiƒô i nazwisko</div>
          </div>

          <div style="margin-top:10px;">
            <label for="phone">Telefon</label>
            <input id="phone" type="tel" required placeholder="+48 600 000 000">
            <div class="form-error" id="phoneError">Proszƒô podaƒá poprawny numer telefonu</div>
          </div>

          <div style="margin-top:10px;">
            <label for="email">Email (opcjonalnie)</label>
            <input id="email" type="email" placeholder="kontakt@przyklad.pl">
            <div class="form-error" id="emailError">Proszƒô podaƒá poprawny adres email</div>
          </div>

          <div class="form-row" style="margin-top:10px;">
            <div class="col">
              <label for="from">SkƒÖd (miasto/adres)</label>
              <input id="from" type="text" required placeholder="Pozna≈Ñ, ul. ≈öwiƒôta 1">
              <div class="form-error" id="fromError">Proszƒô podaƒá miejsce odbioru</div>
            </div>
            <div class="col">
              <label for="to">DokƒÖd (miasto/adres)</label>
              <input id="to" type="text" required placeholder="Berlin, dworzec g≈Ç√≥wny">
              <div class="form-error" id="toError">Proszƒô podaƒá miejsce docelowe</div>
            </div>
          </div>

          <div class="form-row" style="margin-top:10px;">
            <div class="col">
              <label for="date">Data i godzina</label>
              <input id="date" type="datetime-local" required>
              <div class="form-error" id="dateError">Proszƒô wybraƒá datƒô i godzinƒô</div>
            </div>
            <div class="col">
              <label for="people">Liczba os√≥b</label>
              <input id="people" type="number" value="1" min="1" max="8" required>
              <div class="form-error" id="peopleError">Proszƒô podaƒá liczbƒô os√≥b (1-8)</div>
            </div>
          </div>

          <div style="margin-top:10px;">
            <label for="notes">Uwagi (opcjonalnie)</label>
            <textarea id="notes" placeholder="Baga≈º, dzieci, specjalne potrzeby..."></textarea>
          </div>

          <div style="margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <button type="submit" class="submit">Wy≈õlij rezerwacjƒô</button>
            <div class="muted" id="formStatus"></div>
          </div>

          <p class="muted" style="margin-top:10px;">Po wys≈Çaniu rezerwacji ‚Äî zostanie ona zapisana lokalnie (kierowca mo≈ºe jƒÖ zobaczyƒá po zalogowaniu na Panel kierowcy).</p>
        </form>
      </div>

      <!-- Mapa OpenStreetMap -->
      <div class="card" style="margin-top:18px;">
        <h2>Lokalizacja ‚Äî podglƒÖd trasy</h2>
        <p class="small muted">Wpisz adres, aby zobaczyƒá go na mapie.</p>
        
        <div class="map-controls">
          <div class="address-search">
            <input type="text" id="addressInput" placeholder="Wpisz adres do wyszukania...">
            <button class="btn primary" id="searchAddress">Szukaj</button>
          </div>
          <button class="btn ghost" id="clearMap">Wyczy≈õƒá mapƒô</button>
        </div>

        <div id="mapContainer">
          <div id="osmMap"></div>
        </div>
      </div>

      <!-- Opinie -->
      <div id="opinie" class="card" style="margin-top:18px;">
        <h2>Opinie klient√≥w</h2>
        <div class="opinie-wrap">
          <div id="opiniaText" class="opinie">≈Åadowanie opinii...</div>
          <div class="chip">≈örednia: 4.9/5</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Sidebar -->
    <aside>
      <div class="card">
        <h2 id="kierowca">O kierowcy</h2>
        <p><strong>Maniek</strong> ‚Äî spok√≥j za kierownicƒÖ, do≈õwiadczenie i odpowiedzialno≈õƒá. Ponad 10 lat praktyki na trasach lokalnych i miƒôdzynarodowych. Zawsze punktualny, dba o komfort pasa≈ºera i stan techniczny pojazdu.</p>
        <div style="margin-top:12px;" class="icons-row">
          <div class="icon-box"><div class="icon-emoji">üõ°Ô∏è</div><div class="small">Bezpiecze≈Ñstwo</div></div>
          <div class="icon-box"><div class="icon-emoji">üìç</div><div class="small">GPS / ≈öledzenie</div></div>
          <div class="icon-box"><div class="icon-emoji">üöò</div><div class="small">Komfort</div></div>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <h2 id="bezpieczenstwo">Bezpiecze≈Ñstwo</h2>
        <ul style="margin:0 0 0 18px;">
          <li>Regularne przeglƒÖdy techniczne</li>
          <li>Systemy ABS / ESP</li>
          <li>Kierowca z certyfikatem i do≈õwiadczeniem</li>
          <li>Auto dezynfekowane i czyste</li>
        </ul>
      </div>

      <div class="card" style="margin-top:14px;">
        <div class="panel-title">
          <h2>Panel kierowcy</h2>
          <span class="small muted">Dostƒôp lokalny</span>
        </div>
        <p class="small muted">Kierowca widzi rezerwacje po zalogowaniu (has≈Ço). Has≈Ço ustawione w tej stronie to: <strong><span id="secretPlaceholder">ManiekManiek</span></strong></p>
        <button class="btn primary" id="openPanelMobile">Otw√≥rz Panel</button>

        <div id="panelArea" style="display:none; margin-top:12px;">
          <div id="welcomeMessage" class="welcome-message hidden">
            Cze≈õƒá Maniek! Witaj w panelu kierowcy.
          </div>
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:6px; flex-wrap:wrap;">
            <input id="panelPass" type="password" placeholder="Wprowad≈∫ has≈Ço" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06); min-width:150px;">
            <button id="panelLogin" class="btn">Zaloguj</button>
          </div>

          <div id="reservationsList" style="margin-top:12px;"></div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <button id="exportCsv" class="btn ghost">Eksportuj CSV</button>
            <button id="clearAll" class="btn ghost" title="Usu≈Ñ wszystkie lokalne rezerwacje">Usu≈Ñ</button>
          </div>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- CZATBOT -->
<div class="chatbot-container">
  <button class="chatbot-toggle">üí¨</button>
  <div class="chatbot-window">
    <div class="chatbot-header">
      <div class="chatbot-title">Asystent Maniek</div>
      <button class="chatbot-close">√ó</button>
    </div>
    <div class="chatbot-messages">
      <div class="message bot">
        Cze≈õƒá! Jestem asystent Maniek. Jak mogƒô Ci pom√≥c? üòä
      </div>
      <div class="quick-actions">
        <div class="quick-action" data-question="Ile kosztuje przejazd do Berlina?">Cena do Berlina</div>
        <div class="quick-action" data-question="Jakie sƒÖ wolne terminy?">Wolne terminy</div>
        <div class="quick-action" data-question="Jakie sƒÖ zasady bezpiecze≈Ñstwa?">Bezpiecze≈Ñstwo</div>
      </div>
    </div>
    <div class="typing-indicator">Asystent pisze...</div>
    <div class="chatbot-input">
      <input type="text" placeholder="Zadaj pytanie..." id="chatbotInput">
      <button class="chatbot-send">‚û§</button>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="small">¬© <span id="curYear"></span> Maniek ‚Äî Pewny Przew√≥z</div>
  </div>
</footer>

<div class="ribbon">Zaufany przewo≈∫nik</div>

<script>
  // --- Inicjalizacja EmailJS ---
  // Uwaga: ZastƒÖp poni≈ºsze warto≈õci swoimi danymi z EmailJS
  emailjs.init("Tw√≥j_User_ID");

  // --- podstawowe ustawienia ---
  document.getElementById('curYear').textContent = new Date().getFullYear();
  const SECRET_PASS = 'ManiekManiek';
  
  // Opinie rotator
  const opinie = [
    "‚≠ê ‚ÄûKierowca jak z≈Çoto! Spok√≥j i pe≈Çna kultura.‚Äù",
    "‚≠ê ‚ÄûJecha≈Çem do Niemiec ‚Äî zero stresu, pe≈Çen komfort.‚Äù",
    "‚≠ê ‚ÄûBezpiecznie, czysto i zawsze na czas. Polecam!‚Äù",
    "‚≠ê ‚ÄûManiek to kierowca, kt√≥ry naprawdƒô dba o ludzi.‚Äù"
  ];
  let opinIndex = 0;
  function showOpinion(){ 
    document.getElementById('opiniaText').textContent = opinie[opinIndex]; 
    opinIndex=(opinIndex+1)%opinie.length; 
  }
  showOpinion(); 
  setInterval(showOpinion,4500);

  // --- lokalne przechowywanie rezerwacji ---
  const STORAGE_KEY = 'maniek_reservations_v1';

  function loadReservations(){
    try {
      const data = localStorage.getItem(STORAGE_KEY);
      return data ? JSON.parse(data) : [];
    } catch(e){ return []; }
  }
  
  function saveReservations(arr){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  }

  // --- OPENSTREETMAP - DZIA≈ÅAJƒÑCA ---
  let map;
  let currentMarkers = [];

  function initMap() {
    if (!document.getElementById('osmMap')) {
      console.log('Kontener mapy nie gotowy');
      return;
    }
    
    map = L.map('osmMap').setView([52.2297, 21.0122], 6);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);

    // Przelicz rozmiar po za≈Çadowaniu
    setTimeout(() => {
      if (map) map.invalidateSize();
    }, 100);
    
    console.log('Mapa za≈Çadowana');
  }

  function searchOnOSMMap(address) {
    if (!address.trim()) {
      alert('Wpisz adres do wyszukania');
      return;
    }
    
    const searchBtn = document.getElementById('searchAddress');
    const originalText = searchBtn.textContent;
    searchBtn.textContent = 'Szukam...';
    searchBtn.disabled = true;
    
    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`)
      .then(response => response.json())
      .then(data => {
        if (data.length > 0) {
          const lat = parseFloat(data[0].lat);
          const lon = parseFloat(data[0].lon);
          
          // Usu≈Ñ poprzednie markery
          clearMap();
          
          // Dodaj nowy marker
          const marker = L.marker([lat, lon]).addTo(map)
            .bindPopup(`<b>${address}</b>`)
            .openPopup();
          
          currentMarkers.push(marker);
          
          // Przesu≈Ñ mapƒô
          map.setView([lat, lon], 13);
          map.invalidateSize();
        } else {
          alert('Nie znaleziono adresu');
        }
      })
      .catch(error => {
        console.error('B≈ÇƒÖd wyszukiwania:', error);
        alert('B≈ÇƒÖd podczas wyszukiwania');
      })
      .finally(() => {
        searchBtn.textContent = originalText;
        searchBtn.disabled = false;
      });
  }

  function clearMap() {
    currentMarkers.forEach(marker => map.removeLayer(marker));
    currentMarkers = [];
    map.setView([52.2297, 21.0122], 6);
    map.invalidateSize();
  }

  // Inicjuj mapƒô
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(initMap, 500);
  });

  // Event listeners dla mapy
  document.getElementById('searchAddress').addEventListener('click', function() {
    const address = document.getElementById('addressInput').value.trim();
    searchOnOSMMap(address);
  });

  document.getElementById('addressInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      const address = e.target.value.trim();
      searchOnOSMMap(address);
    }
  });

  document.getElementById('clearMap').addEventListener('click', clearMap);

  // --- Walidacja formularza ---
  function validateForm() {
    let isValid = true;
    
    // Reset errors
    document.querySelectorAll('.form-error').forEach(el => {
      el.style.display = 'none';
    });
    
    // Name validation
    const name = document.getElementById('name').value.trim();
    if (!name) {
      document.getElementById('nameError').style.display = 'block';
      isValid = false;
    }
    
    // Phone validation
    const phone = document.getElementById('phone').value.trim();
    const phoneRegex = /^[\+]?[0-9\s\-\(\)]{9,}$/;
    if (!phone || !phoneRegex.test(phone)) {
      document.getElementById('phoneError').style.display = 'block';
      isValid = false;
    }
    
    // Email validation (optional)
    const email = document.getElementById('email').value.trim();
    if (email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        document.getElementById('emailError').style.display = 'block';
        isValid = false;
      }
    }
    
    // From validation
    const from = document.getElementById('from').value.trim();
    if (!from) {
      document.getElementById('fromError').style.display = 'block';
      isValid = false;
    }
    
    // To validation
    const to = document.getElementById('to').value.trim();
    if (!to) {
      document.getElementById('toError').style.display = 'block';
      isValid = false;
    }
    
    // Date validation
    const date = document.getElementById('date').value;
    if (!date) {
      document.getElementById('dateError').style.display = 'block';
      isValid = false;
    }
    
    // People validation
    const people = document.getElementById('people').value;
    if (!people || people < 1 || people > 8) {
      document.getElementById('peopleError').style.display = 'block';
      isValid = false;
    }
    
    return isValid;
  }

  // --- Reszta funkcjonalno≈õci ---
  const form = document.getElementById('bookingForm');
  const formStatus = document.getElementById('formStatus');

  form.addEventListener('submit', function(e){
    e.preventDefault();
    
    if (!validateForm()) {
      formStatus.textContent = 'Proszƒô poprawiƒá b≈Çƒôdy w formularzu.';
      formStatus.style.color = '#ff6b6b';
      setTimeout(()=>formStatus.textContent='','3500');
      return;
    }
    
    const r = {
      id: 'r_' + Date.now(),
      name: document.getElementById('name').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      email: document.getElementById('email').value.trim(),
      from: document.getElementById('from').value.trim(),
      to: document.getElementById('to').value.trim(),
      date: document.getElementById('date').value,
      people: document.getElementById('people').value,
      notes: document.getElementById('notes').value.trim(),
      status: 'pending',
      created_at: new Date().toISOString()
    };

    const arr = loadReservations();
    arr.unshift(r);
    saveReservations(arr);

    // Uwaga: ZastƒÖp poni≈ºsze warto≈õci swoimi danymi z EmailJS
    emailjs.send("Tw√≥j_Service_ID", "Tw√≥j_Template_ID", {
      name: r.name,
      phone: r.phone,
      email: r.email || 'Nie podano',
      from: r.from,
      to: r.to,
      date: new Date(r.date).toLocaleString('pl-PL'),
      people: r.people,
      notes: r.notes || 'Brak uwag',
      created_at: new Date().toLocaleString('pl-PL')
    }).then(() => {
      formStatus.textContent = 'Rezerwacja zapisana i e-mail wys≈Çany!';
      formStatus.style.color = '#4CAF50';
      form.reset();
      setTimeout(()=>formStatus.textContent='','4200');
    }, (error) => {
      formStatus.textContent = 'Rezerwacja zapisana, ale b≈ÇƒÖd e-maila.';
      formStatus.style.color = '#ff9800';
      form.reset();
      setTimeout(()=>formStatus.textContent='','4200');
    });

    renderReservationsTable(); 
  });

  // Panel kierowcy
  const panelArea = document.getElementById('panelArea');
  const panelLoginBtn = document.getElementById('panelLogin');
  const panelPassInput = document.getElementById('panelPass');
  const openPanelBtn = document.getElementById('openPanelBtn');
  const openPanelMobile = document.getElementById('openPanelMobile');
  const reservationsList = document.getElementById('reservationsList');
  const welcomeMessage = document.getElementById('welcomeMessage');

  let isLoggedIn = false;

  function showPanelUI(){
    panelArea.style.display='block';
    document.getElementById('panelPass').focus();
  }

  openPanelBtn.addEventListener('click', ()=>{ 
    showPanelUI(); 
    window.scrollTo({top:0,behavior:'smooth'}); 
  });
  
  openPanelMobile.addEventListener('click', ()=>{ 
    showPanelUI(); 
    window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'}); 
  });

  panelLoginBtn.addEventListener('click', ()=> {
    const pass = panelPassInput.value || '';
    if(pass === SECRET_PASS){
      isLoggedIn = true;
      document.getElementById('panelPass').value = '';
      renderReservationsTable();
      document.getElementById('panelPass').placeholder = 'Zalogowano';
      panelLoginBtn.textContent = 'Od≈õwie≈º';
      welcomeMessage.classList.remove('hidden');
    } else {
      alert('B≈Çƒôdne has≈Ço.');
    }
  });

  function renderReservationsTable(){
    const arr = loadReservations();
    if(arr.length===0){
      reservationsList.innerHTML = '<div class="small muted">Brak rezerwacji.</div>';
      return;
    }

    let html = '<div style="overflow:auto;"><table><thead><tr><th>Imiƒô</th><th>Tel</th><th>Trasa</th><th>Data</th><th>Os√≥b</th><th>Uwagi</th><th>Status</th></tr></thead><tbody>';
    arr.forEach(r=>{
      html += `<tr id="${r.id}"><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.phone)}</td><td>${escapeHtml(r.from)} ‚Üí ${escapeHtml(r.to)}</td><td>${new Date(r.date).toLocaleString()}</td><td>${escapeHtml(r.people)}</td><td>${escapeHtml(r.notes)}</td><td><select data-id="${r.id}" onchange="changeStatus(this)"><option ${r.status==='pending'?'selected':''}>pending</option><option ${r.status==='accepted'?'selected':''}>accepted</option><option ${r.status==='rejected'?'selected':''}>rejected</option></select></td></tr>`;
    });
    html += '</tbody></table></div>';
    reservationsList.innerHTML = html;
  }

  window.changeStatus = function(sel){
    const id = sel.dataset.id;
    const newStatus = sel.value;
    let arr = loadReservations();
    arr = arr.map(r => r.id===id ? Object.assign({}, r, {status:newStatus}) : r);
    saveReservations(arr);
    renderReservationsTable();
  };

  document.getElementById('exportCsv').addEventListener('click', ()=> {
    const arr = loadReservations();
    if(arr.length===0){ alert('Brak rezerwacji do eksportu.'); return; }
    const header = ['id','name','phone','email','from','to','date','people','notes','status','created_at'];
    const rows = arr.map(r => header.map(h => `"${(r[h]||'').toString().replace(/"/g,'""')}"`).join(','));
    const csv = [header.join(','), ...rows].join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; 
    a.download = 'rezerwacje_maniek.csv'; 
    document.body.appendChild(a); 
    a.click(); 
    a.remove();
    URL.revokeObjectURL(url);
  });

  document.getElementById('clearAll').addEventListener('click', ()=>{
    if(!confirm('UsunƒÖƒá wszystkie lokalne rezerwacje?')) return;
    localStorage.removeItem(STORAGE_KEY);
    renderReservationsTable();
  });

  renderReservationsTable();

  function escapeHtml(s=''){ 
    return String(s).replace(/[&<>"']/g, function(m){ 
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; 
    }); 
  }

  // CZATBOT
  const chatbotToggle = document.querySelector('.chatbot-toggle');
  const chatbotWindow = document.querySelector('.chatbot-window');
  const chatbotClose = document.querySelector('.chatbot-close');
  const chatbotInput = document.getElementById('chatbotInput');
  const chatbotSend = document.querySelector('.chatbot-send');
  const chatbotMessages = document.querySelector('.chatbot-messages');
  const typingIndicator = document.querySelector('.typing-indicator');
  const quickActions = document.querySelectorAll('.quick-action');

  const knowledgeBase = {
    prices: {
      'berlin': '350-450 PLN',
      'warszawa': '250-350 PLN', 
      'krak√≥w': '200-300 PLN',
      'wroc≈Çaw': '180-280 PLN',
      'gda≈Ñsk': '300-400 PLN'
    },
    safety: {
      'bezpiecze≈Ñstwo': 'Nasze standardy bezpiecze≈Ñstwa: regularne przeglƒÖdy techniczne, systemy ABS/ESP, obowiƒÖzkowe pasy bezpiecze≈Ñstwa, zakaz spo≈ºywania alkoholu, dezynfekcja pojazdu po ka≈ºdym kursie.',
      'przeglƒÖdy': 'Pojazd przechodzi comiesiƒôczne przeglƒÖdy techniczne i jest ubezpieczony OC/AC/NNW.',
      'kierowca': 'Maniek ma ponad 10 lat do≈õwiadczenia, certyfikaty bezpiecznej jazdy i czysty rekord kierowcy.'
    },
    info: {
      'max passengers': 'Maksymalnie 7 pasa≈ºer√≥w + kierowca',
      'payment': 'P≈Çatno≈õƒá got√≥wkƒÖ lub przelewem, 50% zaliczki przy rezerwacji',
      'luggage': 'Dopuszczamy baga≈º do 20kg na osobƒô'
    },
    responses: {
      'greeting': 'Cze≈õƒá! Jestem asystent Maniek. Mogƒô pom√≥c z rezerwacjami, cenami, trasami i bezpiecze≈Ñstwem. üòä',
      'help': 'Mogƒô pom√≥c Ci z: rezerwacjami, cenami przejazd√≥w, dostƒôpnymi terminami, zasadami bezpiecze≈Ñstwa i innymi pytaniami.',
      'unknown': 'Przepraszam, nie znam odpowiedzi na to pytanie. Proszƒô skontaktuj siƒô bezpo≈õrednio z Maniekiem pod numerem +48 600 000 000.',
      'booking': 'Aby zarezerwowaƒá przejazd, u≈ºyj formularza na stronie lub zadzwo≈Ñ do Manieka bezpo≈õrednio.',
      'contact': 'Kontakt: Maniek +48 600 000 000, email: maniek@pewnyprzewoz.pl'
    }
  };

  chatbotToggle.addEventListener('click', () => {
    chatbotWindow.style.display = 'flex';
    chatbotToggle.style.display = 'none';
  });

  chatbotClose.addEventListener('click', () => {
    chatbotWindow.style.display = 'none';
    chatbotToggle.style.display = 'flex';
  });

  quickActions.forEach(action => {
    action.addEventListener('click', () => {
      const question = action.getAttribute('data-question');
      chatbotInput.value = question;
      sendMessage();
    });
  });

  function sendMessage() {
    const message = chatbotInput.value.trim();
    if (!message) return;

    addMessage(message, 'user');
    chatbotInput.value = '';

    typingIndicator.style.display = 'block';
    
    setTimeout(() => {
      typingIndicator.style.display = 'none';
      const response = generateResponse(message);
      addMessage(response, 'bot');
    }, 1000 + Math.random() * 1000);
  }

  chatbotSend.addEventListener('click', sendMessage);
  chatbotInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
  });

  function addMessage(text, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    messageDiv.textContent = text;
    chatbotMessages.appendChild(messageDiv);
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
  }

  function generateResponse(message) {
    const lowerMessage = message.toLowerCase();
    
    if (lowerMessage.includes('cze≈õƒá') || lowerMessage.includes('hej') || lowerMessage.includes('witam')) {
      return knowledgeBase.responses.greeting;
    }
    
    for (const [city, price] of Object.entries(knowledgeBase.prices)) {
      if (lowerMessage.includes(city)) {
        return `Przejazd do ${city.charAt(0).toUpperCase() + city.slice(1)} kosztuje ${price}. Cena zale≈ºy od dok≈Çadnej lokalizacji i liczby pasa≈ºer√≥w.`;
      }
    }
    
    for (const [key, info] of Object.entries(knowledgeBase.safety)) {
      if (lowerMessage.includes(key)) {
        return info;
      }
    }
    
    for (const [key, info] of Object.entries(knowledgeBase.info)) {
      if (lowerMessage.includes(key)) {
        return info;
      }
    }
    
    if (lowerMessage.includes('termin') || lowerMessage.includes('wolny')) {
      const reservations = loadReservations();
      return `Aktualnie mam ${reservations.length} rezerwacji. Proszƒô sprawdziƒá konkretnƒÖ datƒô przez formularz rezerwacji lub zadzwo≈Ñ bezpo≈õrednio.`;
    }
    
    if (lowerMessage.includes('rezerwacja')) {
      return knowledgeBase.responses.booking;
    }
    
    if (lowerMessage.includes('kontakt') || lowerMessage.includes('telefon')) {
      return knowledgeBase.responses.contact;
    }
    
    return knowledgeBase.responses.unknown;
  }
</script>

</body>
</html>

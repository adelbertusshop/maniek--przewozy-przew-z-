<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Maniek ‚Äî Pewny Przew√≥z | Mariusz Krawczyk</title>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  :root{
    --bg-deep:#0f1724;
    --card:#172433;
    --accent:#4FA3FF;
    --accent-2:#DAA520;
    --muted:#9fb3d6;
    --white:#ffffff;
  }

  *{box-sizing:border-box; margin:0; padding:0;}
  body{
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg, rgba(11,19,33,0.94) 0%, rgba(9,13,22,0.92) 100%), url('https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat fixed;
    color:var(--white);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding-bottom:60px;
    min-height:100vh;
  }

  header{
    background: rgba(27,42,65,0.95);
    border-bottom: 1px solid rgba(79,163,255,0.08);
    padding:12px 16px;
    position:sticky;
    top:0;
    z-index:100;
    backdrop-filter: blur(10px);
  }
  
  .container{ 
    max-width:1100px; 
    margin:0 auto; 
    padding:0 16px; 
    width:100%;
  }
  
  .brand{ 
    display:flex; 
    align-items:center; 
    gap:10px; 
    flex-wrap:wrap;
  }
  
  .logo {
    width:44px;
    height:44px;
    border-radius:8px;
    background:linear-gradient(135deg,var(--accent),#2b6ce3);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#0b1724;
    box-shadow:0 3px 14px rgba(11,19,33,0.5);
    flex-shrink:0;
  }
  
  .brand h1{ 
    margin:0; 
    font-size:clamp(14px, 4vw, 16px);
    line-height:1.2;
  }
  
  .brand p{ 
    margin:0;
    font-size:clamp(10px, 3vw, 12px);
    color:var(--muted);
    width:100%;
  }

  nav{ 
    margin-left:auto; 
    display:flex; 
    gap:8px; 
    align-items:center;
    flex-wrap:wrap;
  }
  
  .btn {
    background:transparent;
    border:1px solid rgba(255,255,255,0.06); 
    color:var(--white);
    padding:6px 10px;
    border-radius:6px;
    font-weight:600;
    cursor:pointer;
    text-decoration:none;
    font-size:12px;
    white-space:nowrap;
    transition: all 0.3s ease;
  }
  
  .btn:hover {
    background: rgba(255,255,255,0.05);
  }
  
  .btn.primary{ 
    background:var(--accent); 
    color:#072033; 
    border:none; 
  }
  
  .btn.primary:hover {
    background: #3a8de6;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79,163,255,0.3);
  }
  
  .btn.ghost{ background:transparent; }

  main{ 
    padding:20px 0;
    min-height:calc(100vh - 200px);
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr;
    gap:16px;
    align-items:start;
  }

  @media (min-width: 768px) {
    .grid{ 
      grid-template-columns: 1fr 360px;
      gap:20px;
    }
    
    .brand p{
      width:auto;
    }
    
    .btn {
      padding:8px 12px;
      font-size:14px;
    }
    
    header {
      padding:16px;
    }
  }

  @media (max-width: 480px) {
    nav{ 
      display:none; 
    }
    
    .brand {
      justify-content:center;
      text-align:center;
    }
  }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:16px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    border:1px solid rgba(255,255,255,0.03);
    width:100%;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(2,6,23,0.8);
  }

  h2{ 
    margin:0 0 10px 0; 
    color:var(--accent); 
    font-size:clamp(16px, 4vw, 18px);
  }
  
  label{ 
    display:block; 
    font-size:13px; 
    color:var(--muted); 
    margin-bottom:6px; 
  }
  
  input[type=text], input[type=email], input[type=tel], input[type=datetime-local], textarea, select, input[type=number]{
    width:100%; 
    padding:10px 12px; 
    border-radius:8px; 
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02); 
    color:var(--white); 
    outline:none; 
    font-size:14px;
    min-height:44px;
    transition: border 0.3s ease;
  }
  
  input:focus, textarea:focus, select:focus {
    border-color: var(--accent);
  }
  
  textarea{ 
    min-height:90px; 
    resize:vertical; 
  }

  .form-row{ 
    display:flex; 
    flex-direction:column;
    gap:10px; 
  }
  
  .form-row .col{ 
    flex:1; 
    width:100%;
  }

  @media (min-width: 480px) {
    .form-row{
      flex-direction:row;
    }
  }

  .submit {
    display:inline-block;
    padding:12px 16px;
    border-radius:10px;
    border:none;
    background:linear-gradient(90deg,var(--accent),#2b6ce3);
    color:#021224;
    font-weight:700;
    cursor:pointer;
    margin-top:8px;
    font-size:14px;
    min-height:44px;
    width:100%;
    transition: all 0.3s ease;
  }

  .submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(79,163,255,0.4);
  }

  @media (min-width: 480px) {
    .submit {
      width:auto;
    }
  }

  .muted{ color:var(--muted); font-size:13px; margin-top:8px; }

  .panel-title{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
  table{ width:100%; border-collapse:collapse; margin-top:12px; font-size:14px; overflow-x:auto; display:block; }
  th,td{ padding:8px 10px; border-bottom:1px dashed rgba(255,255,255,0.04); text-align:left; white-space:nowrap; }
  th{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:0.6px; }

  .chip{ background:rgba(255,255,255,0.03); padding:6px 10px; border-radius:999px; font-size:13px; display:inline-block; color:var(--muted); }

  .icons-row{ 
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap:10px;
    justify-content:center;
    margin:14px 0;
  }
  
  .icon-box{ 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    gap:6px; 
    padding:12px; 
    border-radius:10px; 
    background:rgba(255,255,255,0.02); 
    text-align:center;
    min-height:80px;
    transition: transform 0.3s ease, background 0.3s ease;
  }
  
  .icon-box:hover {
    transform: translateY(-5px);
    background: rgba(255,255,255,0.05);
  }
  
  .icon-emoji{ font-size:24px; }

  footer{ 
    text-align:center; 
    color:var(--muted); 
    padding:20px 8px; 
    margin-top:20px; 
    font-size:13px;
  }
  
  .small{ font-size:13px;color:var(--muted); }

  .opinie{ font-style:italic; opacity:0.95; font-size:15px; line-height:1.4; }
  .opinie-wrap{ display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap; }

  .ribbon{ 
    position:fixed; 
    right:10px; 
    bottom:70px; 
    background:var(--accent-2); 
    color:#072033; 
    padding:8px 12px; 
    border-radius:999px; 
    font-weight:700; 
    box-shadow:0 6px 18px rgba(10,14,25,0.6); 
    z-index:60;
    font-size:12px;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  .hidden { display: none !important; }
  
  .contact-info {
    background: linear-gradient(135deg, rgba(79,163,255,0.1), rgba(218,165,32,0.1));
    border: 1px solid rgba(79,163,255,0.2);
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
    text-align: center;
  }
  
  .contact-info h3 {
    color: var(--accent);
    margin-bottom: 10px;
    font-size: 18px;
  }
  
  .contact-links {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
  }
  
  .contact-link {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--white);
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
    transition: all 0.3s ease;
    font-size: 14px;
  }
  
  .contact-link:hover {
    background: var(--accent);
    color: #072033;
    transform: translateY(-2px);
  }
  
  .owner-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, var(--accent-2), #b8860b);
    color: #072033;
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 12px;
    margin-left: 8px;
  }

  /* ===== SEKCJA PARTNERZY ===== */
  #partners {
    background: rgba(11,19,33,0.95) !important;
    border-top: 1px solid rgba(255,255,255,0.05);
    padding:40px 0;
    margin-top: 40px;
  }
  
  #partners .max-w-6xl {
    max-width: 1100px;
    margin: 0 auto;
    padding:0 16px;
  }
  
  #partners h2 {
    color: var(--accent);
    text-align: center;
    margin-bottom: 20px;
    font-size:clamp(20px, 5vw, 24px);
  }
  
  #partners p {
    color: var(--muted);
    text-align: center;
    margin-bottom: 25px;
    font-size:14px;
  }
  
  .partners-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    place-items: center;
  }
  
  .partner-card {
    background: rgba(255,255,255,0.03);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
    cursor: pointer;
    text-align: center;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 120px;
  }
  
  .partner-card:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    transform: translateY(-5px);
    background: rgba(255,255,255,0.05);
  }
  
  .partner-icon {
    font-size: 32px;
    margin-bottom: 10px;
  }
  
  .partner-name {
    color: var(--white);
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 5px;
  }
  
  .partner-desc {
    color: var(--muted);
    font-size: 12px;
  }

  @media (min-width: 768px) {
    .partners-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: 25px;
    }
    
    .partner-card {
      min-height: 140px;
      padding: 1.5rem;
    }
    
    .partner-icon {
      font-size: 40px;
    }
  }

  /* ===== SEKCJA KORZY≈öCI DLA KLIENT√ìW ===== */
  #benefits {
    background: var(--card) !important;
    border-top: 1px solid rgba(255,255,255,0.05);
    padding: 40px 0;
    margin-top: 40px;
  }
  
  #benefits .max-w-5xl {
    max-width: 1100px;
    margin: 0 auto;
    padding:0 16px;
  }
  
  #benefits h2 {
    color: var(--accent);
    text-align: center;
    margin-bottom: 10px;
    font-size:clamp(20px, 5vw, 24px);
  }
  
  #benefits p {
    color: var(--muted);
    text-align: center;
    margin-bottom: 30px;
    font-size:14px;
  }
  
  .benefits-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 20px;
  }
  
  .benefit-card {
    background: linear-gradient(135deg, rgba(79,163,255,0.1), rgba(218,165,32,0.05));
    border: 1px solid rgba(79,163,255,0.2);
    border-radius: 12px;
    padding: 25px 20px;
    text-align: center;
    transition: all 0.3s ease;
  }
  
  .benefit-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(79,163,255,0.2);
    border-color: var(--accent);
  }
  
  .benefit-icon {
    font-size: 48px;
    margin-bottom: 15px;
  }
  
  .benefit-title {
    color: var(--white);
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 10px;
  }
  
  .benefit-desc {
    color: var(--muted);
    font-size: 14px;
    line-height: 1.5;
  }

  @media (min-width: 768px) {
    .benefits-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
    }
    
    .benefit-card {
      padding: 30px 25px;
    }
  }

  /* ===== NOWY SUPER CZATBOT ===== */
  .chatbot-toggle {
    position: fixed; bottom: 12px; right: 12px; z-index: 1200;
    width:60px; height:60px; border-radius:50%; background:linear-gradient(135deg,#4FA3FF,#2b6ce3);
    color:#072033; font-size:26px; display:flex; align-items:center; justify-content:center; border:none; cursor:pointer; box-shadow:0 6px 18px rgba(2,6,23,0.45);
    transition: all 0.3s ease;
  }

  .chatbot-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }

  .chatbot-window {
    position: fixed; bottom: 84px; right: 12px; z-index:1200;
    width:360px; max-width:calc(100% - 24px); height:520px; background:var(--card); border-radius:12px; display:none; flex-direction:column; overflow:hidden;
    box-shadow:0 20px 40px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.06);
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @media (max-width:420px) {
    .chatbot-window { width:92%; right:4%; bottom:78px; height:62vh; }
    .chatbot-toggle { right: 6%; bottom: 8px; }
  }

  .chatbot-header { 
    display:flex; align-items:center; justify-content:space-between; padding:12px 14px; 
    background:rgba(27,42,65,0.95); border-bottom:1px solid rgba(255,255,255,0.04); color:var(--accent); font-weight:700; 
  }

  .chatbot-messages { 
    flex:1; padding:12px; overflow-y:auto; display:flex; flex-direction:column; gap:8px; 
  }

  .message { 
    max-width:85%; padding:8px 12px; border-radius:12px; line-height:1.3; font-size:14px; 
    animation: messageAppear 0.3s ease;
  }

  @keyframes messageAppear {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .message.user { 
    align-self:flex-end; background:linear-gradient(90deg,var(--accent),#2b6ce3); color:#072033; border-bottom-right-radius:4px; 
  }

  .message.bot { 
    align-self:flex-start; background:rgba(255,255,255,0.03); color:var(--white); border-bottom-left-radius:4px; 
  }

  .typing-indicator { 
    padding:8px 12px; font-style:italic; color:var(--muted); display:none; 
  }

  .chatbot-input { 
    display:flex; gap:8px; padding:10px; border-top:1px solid rgba(255,255,255,0.03); 
    background: linear-gradient(180deg, rgba(0,0,0,0.02), transparent); 
  }

  .chatbot-input input { 
    flex:1; padding:10px 12px; border-radius:999px; border:1px solid rgba(255,255,255,0.04); 
    background:rgba(255,255,255,0.02); color:var(--white); outline:none; 
  }

  .chatbot-send { 
    width:44px; height:44px; border-radius:50%; background:var(--accent); border:none; color:#072033; 
    cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:700; 
    transition: all 0.3s ease;
  }

  .chatbot-send:hover {
    background: #3a8de6;
    transform: scale(1.05);
  }

  .quick-actions { 
    display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; 
  }

  .quick-action { 
    padding:6px 10px; border-radius:999px; background:rgba(255,255,255,0.03); color:var(--muted); 
    border:1px solid rgba(255,255,255,0.06); cursor:pointer; font-size:12px; 
    transition: all 0.3s ease;
  }

  .quick-action:hover { 
    background:var(--accent); color:#072033; 
  }

  .chat-link { 
    color:var(--accent); text-decoration:underline; cursor:pointer; 
  }

  /* ===== NOWA MAPA ===== */
  #map { 
    width:100%; height:360px; border-radius:10px; 
    background: var(--card);
  }

  #searchBox { 
    width:100%; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02); color:var(--white); margin-bottom:10px; 
    outline: none;
  }

  #searchBox:focus {
    border-color: var(--accent);
  }

  .leaflet-container {
    background: var(--card) !important;
    font-family: inherit !important;
  }

  .form-error {
    color: #ff6b6b;
    font-size: 12px;
    margin-top: 4px;
    display: none;
  }

  .success-message {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    text-align: center;
    animation: fadeIn 0.5s ease;
  }

  .loading {
    opacity: 0.7;
    pointer-events: none;
  }

  .welcome-message {
    background: linear-gradient(135deg, var(--accent), #2b6ce3);
    color: #072033;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    text-align: center;
    font-weight: bold;
    font-size: 18px;
    animation: fadeIn 0.5s ease;
  }
</style>
</head>
<body>

<header>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
    <div class="brand">
      <div class="logo">MP</div>
      <div>
        <h1>Maniek ‚Äî Pewny Przew√≥z <span class="owner-badge">Mariusz Krawczyk</span></h1>
        <p>Bezpiecznie. Na czas. Zawsze. | Tel: +48 575 686 277</p>
      </div>
    </div>

    <nav>
      <a class="btn" href="#kierowca">O kierowcy</a>
      <a class="btn" href="#bezpieczenstwo">Bezpiecze≈Ñstwo</a>
      <a class="btn" href="#opinie">Opinie</a>
      <a class="btn" href="#benefits">Korzy≈õci</a>
      <a class="btn" href="#partners">Partnerzy</a>
      <a class="btn primary" id="openPanelBtn">Panel kierowcy</a>
    </nav>
  </div>
</header>

<main class="container">
  <div class="grid">
    <div>
      <div class="card">
        <h2>Zarezerwuj przejazd</h2>
        <p class="small muted">Wype≈Çnij formularz ‚Äî Mariusz Krawczyk potwierdzi telefonicznie.</p>

        <div class="contact-info">
          <h3>üìû Bezpo≈õredni kontakt z w≈Ça≈õcicielem</h3>
          <div class="contact-links">
            <a href="tel:+48575686277" class="contact-link">
              <span>üìû</span> +48 575 686 277
            </a>
            <a href="mailto:mariusz.krawczyk7.88@gmail.com" class="contact-link">
              <span>‚úâÔ∏è</span> mariusz.krawczyk7.88@gmail.com
            </a>
          </div>
        </div>

        <form id="bookingForm" autocomplete="off">
          <div style="margin-top:12px;">
            <label for="name">Imiƒô i nazwisko</label>
            <input id="name" type="text" required placeholder="Jan Kowalski">
            <div class="form-error" id="nameError">Proszƒô podaƒá imiƒô i nazwisko</div>
          </div>

          <div style="margin-top:10px;">
            <label for="phone">Telefon</label>
            <input id="phone" type="tel" required placeholder="+48 600 000 000">
            <div class="form-error" id="phoneError">Proszƒô podaƒá poprawny numer telefonu</div>
          </div>

          <div style="margin-top:10px;">
            <label for="email">Email (opcjonalnie)</label>
            <input id="email" type="email" placeholder="kontakt@przyklad.pl">
            <div class="form-error" id="emailError">Proszƒô podaƒá poprawny adres email</div>
          </div>

          <div class="form-row" style="margin-top:10px;">
            <div class="col">
              <label for="from">SkƒÖd (miasto/adres)</label>
              <input id="from" type="text" required placeholder="Pozna≈Ñ, ul. ≈öwiƒôta 1">
              <div class="form-error" id="fromError">Proszƒô podaƒá miejsce odbioru</div>
            </div>
            <div class="col">
              <label for="to">DokƒÖd (miasto/adres)</label>
              <input id="to" type="text" required placeholder="Berlin, dworzec g≈Ç√≥wny">
              <div class="form-error" id="toError">Proszƒô podaƒá miejsce docelowe</div>
            </div>
          </div>

          <div class="form-row" style="margin-top:10px;">
            <div class="col">
              <label for="date">Data i godzina</label>
              <input id="date" type="datetime-local" required>
              <div class="form-error" id="dateError">Proszƒô wybraƒá datƒô i godzinƒô</div>
            </div>
            <div class="col">
              <label for="people">Liczba os√≥b</label>
              <input id="people" type="number" value="1" min="1" max="8" required>
              <div class="form-error" id="peopleError">Proszƒô podaƒá liczbƒô os√≥b (1-8)</div>
            </div>
          </div>

          <div style="margin-top:10px;">
            <label for="notes">Uwagi (opcjonalnie)</label>
            <textarea id="notes" placeholder="Baga≈º, dzieci, specjalne potrzeby..."></textarea>
          </div>

          <div style="margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <button type="submit" class="submit">Wy≈õlij rezerwacjƒô</button>
            <div class="muted" id="formStatus"></div>
          </div>

          <p class="muted" style="margin-top:10px;">Po wys≈Çaniu rezerwacji ‚Äî zostanie ona zapisana lokalnie i wys≈Çana bezpo≈õrednio na email w≈Ça≈õciciela.</p>
        </form>
      </div>

      <!-- NOWA MAPA OpenStreetMap -->
      <div class="card" style="margin-top:18px;">
        <h2>Lokalizacja ‚Äî podglƒÖd trasy</h2>
        <p class="small muted">Wpisz adres, aby zobaczyƒá go na mapie.</p>
        
        <input id="searchBox" placeholder="Wpisz ulicƒô i miasto ‚Äî np. 'D≈Çuga 5, Pozna≈Ñ'">
        <div id="map"></div>
      </div>

      <!-- Opinie -->
      <div id="opinie" class="card" style="margin-top:18px;">
        <h2>Opinie klient√≥w</h2>
        <div class="opinie-wrap">
          <div id="opiniaText" class="opinie">≈Åadowanie opinii...</div>
          <div class="chip">≈örednia: 4.9/5</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Sidebar -->
    <aside>
      <div class="card">
        <h2 id="kierowca">O kierowcy</h2>
        <p><strong>Mariusz "Maniek" Krawczyk</strong> ‚Äî w≈Ça≈õciciel firmy z 12-letnim do≈õwiadczeniem. Specjalizacja w trasach miƒôdzynarodowych PL‚ÜîDE/NL/BE. Certyfikowany kierowca z kursem pierwszej pomocy. Spok√≥j i kultura osobista gwarantowane.</p>
        
        <div class="contact-info" style="margin: 15px 0; padding: 12px;">
          <div style="text-align: center;">
            <div style="font-weight: bold; color: var(--accent); margin-bottom: 5px;">W≈Ça≈õciciel</div>
            <div>Mariusz Krawczyk</div>
            <div style="font-size: 12px; color: var(--muted); margin-top: 5px;">
              Tel: +48 575 686 277<br>
              Email: mariusz.krawczyk7.88@gmail.com
            </div>
          </div>
        </div>
        
        <div style="margin-top:12px;" class="icons-row">
          <div class="icon-box"><div class="icon-emoji">üõ°Ô∏è</div><div class="small">Bezpiecze≈Ñstwo</div></div>
          <div class="icon-box"><div class="icon-emoji">üìç</div><div class="small">GPS / ≈öledzenie</div></div>
          <div class="icon-box"><div class="icon-emoji">üöò</div><div class="small">Komfort</div></div>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <h2 id="bezpieczenstwo">Bezpiecze≈Ñstwo</h2>
        <ul style="margin:0 0 0 18px;">
          <li>Regularne przeglƒÖdy techniczne</li>
          <li>Systemy ABS / ESP</li>
          <li>Kierowca z certyfikatem i do≈õwiadczeniem</li>
          <li>Auto dezynfekowane i czyste</li>
          <li>Pe≈Çne ubezpieczenie OC/AC + NNW</li>
        </ul>
      </div>

      <div class="card" style="margin-top:14px;">
        <div class="panel-title">
          <h2>Panel kierowcy</h2>
          <span class="small muted">Dostƒôp lokalny</span>
        </div>
        <p class="small muted">Kierowca widzi rezerwacje po zalogowaniu (has≈Ço). Has≈Ço ustawione w tej stronie to: <strong><span id="secretPlaceholder">ManiekManiek</span></strong></p>
        <button class="btn primary" id="openPanelMobile">Otw√≥rz Panel</button>

        <div id="panelArea" style="display:none; margin-top:12px;">
          <div id="welcomeMessage" class="welcome-message hidden">
            Cze≈õƒá Mariusz! Witaj w panelu kierowcy.
          </div>
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:6px; flex-wrap:wrap;">
            <input id="panelPass" type="password" placeholder="Wprowad≈∫ has≈Ço" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06); min-width:150px;">
            <button id="panelLogin" class="btn">Zaloguj</button>
          </div>

          <div id="reservationsList" style="margin-top:12px;"></div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <button id="exportCsv" class="btn ghost">Eksportuj CSV</button>
            <button id="clearAll" class="btn ghost" title="Usu≈Ñ wszystkie lokalne rezerwacje">Usu≈Ñ</button>
          </div>
        </div>
      </div>
    </aside>
  </div>
</main>

<!-- SEKCJA KORZY≈öCI DLA KLIENT√ìW -->
<section id="benefits">
  <div class="max-w-5xl">
    <h2>Dlaczego warto wybraƒá nasze us≈Çugi?</h2>
    <p>Komfort, bezpiecze≈Ñstwo i niezawodno≈õƒá ‚Äî to nasze priorytety</p>
    
    <div class="benefits-grid">
      <div class="benefit-card">
        <div class="benefit-icon">üöó</div>
        <h3 class="benefit-title">Komfort Podr√≥≈ºy</h3>
        <p class="benefit-desc">Nowoczesne, klimatyzowane samochody z wygodnymi fotelami. Maksymalny komfort nawet podczas d≈Çugich tras.</p>
      </div>
      
      <div class="benefit-card">
        <div class="benefit-icon">‚è±Ô∏è</div>
        <h3 class="benefit-title">Terminowo≈õƒá</h3>
        <p class="benefit-desc">Zawsze dotrzymujemy termin√≥w. Punktualno≈õƒá to nasza wizyt√≥wka. Dojedziemy na czas, bez wzglƒôdu na warunki.</p>
      </div>
      
      <div class="benefit-card">
        <div class="benefit-icon">üí∞</div>
        <h3 class="benefit-title">Konkurencyjne Ceny</h3>
        <p class="benefit-desc">Atrakcyjne ceny bez ukrytych koszt√≥w. Oferujemy najlepszy stosunek jako≈õci do ceny na rynku.</p>
      </div>
    </div>
  </div>
</section>

<!-- SEKCJA PARTNERZY -->
<section id="partners">
  <div class="max-w-6xl">
    <h2>Nasi Zaufani Partnerzy</h2>
    <p>Wsp√≥≈Çpracujemy z najlepszymi firmami dla zapewnienia najwy≈ºszej jako≈õci us≈Çug</p>
    
    <div class="partners-grid">
      <div class="partner-card">
        <div class="partner-icon">üè®</div>
        <div class="partner-name">Hotel Premium</div>
        <div class="partner-desc">Partner hotelowy</div>
      </div>
      
      <div class="partner-card">
        <div class="partner-icon">‚úàÔ∏è</div>
        <div class="partner-name">Lotnisko Okƒôcie</div>
        <div class="partner-desc">Transfery lotniskowe</div>
      </div>
      
      <div class="partner-card">
        <div class="partner-icon">üè¢</div>
        <div class="partner-name">Business Center</div>
        <div class="partner-desc">Transfery korporacyjne</div>
      </div>
      
      <div class="partner-card">
        <div class="partner-icon">üéØ</div>
        <div class="partner-name">Event Masters</div>
        <div class="partner-desc">Transport eventowy</div>
      </div>
    </div>
  </div>
</section>

<!-- NOWY SUPER CZATBOT -->
<button class="chatbot-toggle" title="Asystent Maniek">üí¨</button>

<div class="chatbot-window" aria-hidden="true">
  <div class="chatbot-header">
    <div>Asystent Mariusz</div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="langBtn" class="btn" title="Zmie≈Ñ jƒôzyk" style="background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted);padding:6px;border-radius:8px">PL</button>
      <button id="chatClose" style="background:transparent;border:none;color:var(--muted);font-size:20px;cursor:pointer">‚úï</button>
    </div>
  </div>

  <div class="chatbot-messages" id="cbMessages">
    <!-- messages go here -->
  </div>

  <div style="padding:0 12px;">
    <div class="quick-actions" id="quickActions">
      <div class="quick-action" data-q="Ile kosztuje przejazd do Berlina?">Cena do Berlina</div>
      <div class="quick-action" data-q="Jakie sƒÖ wolne terminy?">Wolne terminy</div>
      <div class="quick-action" data-q="Jakie sƒÖ zasady bezpiecze≈Ñstwa?">Bezpiecze≈Ñstwo</div>
      <div class="quick-action" data-q="Rezerwacja trasy">Zarezerwuj</div>
      <div class="quick-action" data-q="Hit sezonu">Hit sezonu</div>
    </div>
  </div>

  <div class="typing-indicator" id="cbTyping">Asystent pisze...</div>

  <div class="chatbot-input">
    <input id="cbInput" placeholder="Napisz wiadomo≈õƒá lub podaj trasƒô (SkƒÖd ‚Üí DokƒÖd)..." />
    <button class="chatbot-send" id="cbSend">‚û§</button>
  </div>
</div>

<footer>
  <div class="container">
    <div class="small">¬© <span id="curYear"></span> Maniek ‚Äî Pewny Przew√≥z | Mariusz Krawczyk | Tel: +48 575 686 277 | Email: mariusz.krawczyk7.88@gmail.com</div>
  </div>
</footer>

<div class="ribbon">Zaufany przewo≈∫nik</div>

<script>
// =========================
// SCALONY KOD - SUPER CZATBOT + MAPA + FORMULARZ
// Z DANAMI W≈ÅA≈öCICIELA: Mariusz Krawczyk
// =========================

// --- podstawowe ustawienia ---
document.getElementById('curYear').textContent = new Date().getFullYear();
const SECRET_PASS = 'ManiekManiek';

// --- DANE W≈ÅA≈öCICIELA ---
const OWNER_DATA = {
  name: 'Mariusz Krawczyk',
  phone: '+48 575 686 277',
  email: 'mariusz.krawczyk7.88@gmail.com',
  formalName: 'Mariusz "Maniek" Krawczyk'
};

// --- lokalne przechowywanie rezerwacji ---
const STORAGE_KEY = 'maniek_reservations_v1';

function loadReservations(){
  try {
    const data = localStorage.getItem(STORAGE_KEY);
    return data ? JSON.parse(data) : [];
  } catch(e){ return []; }
}

function saveReservations(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

// --- Funkcja wysy≈ÇajƒÖca email do w≈Ça≈õciciela ---
function sendEmailToOwner(bookingData) {
  const subject = `Nowa rezerwacja od ${bookingData.name}`;
  const body = `
NOWA REZERWACJA - Maniek Pewny Przew√≥z

DANE KLIENTA:
Imiƒô i nazwisko: ${bookingData.name}
Telefon: ${bookingData.phone}
Email: ${bookingData.email || 'Nie podano'}

SZCZEG√ì≈ÅY PRZEJAZDU:
Trasa: ${bookingData.from} ‚Üí ${bookingData.to}
Data i godzina: ${new Date(bookingData.date).toLocaleString('pl-PL')}
Liczba os√≥b: ${bookingData.people}

UWAGI:
${bookingData.notes || 'Brak uwag'}

DATA REZERWACJI: ${new Date(bookingData.created_at).toLocaleString('pl-PL')}
ID REZERWACJI: ${bookingData.id}
  `.trim();

  // Otw√≥rz klienta poczty z wype≈Çnionym emailem
  const mailtoLink = `mailto:${OWNER_DATA.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  window.location.href = mailtoLink;
}

// --- Opinie rotator ---
const opinie = [
  "‚≠ê ‚ÄûMariusz to kierowca jak z≈Çoto! Spok√≥j i pe≈Çna kultura.‚Äù",
  "‚≠ê ‚ÄûJecha≈Çem do Niemiec ‚Äî zero stresu, pe≈Çen komfort. Polecam!‚Äù",
  "‚≠ê ‚ÄûBezpiecznie, czysto i zawsze na czas. Mariusz to profesjonalista!‚Äù",
  "‚≠ê ‚ÄûManiek to kierowca, kt√≥ry naprawdƒô dba o ludzi i ich bezpiecze≈Ñstwo.‚Äù"
];
let opinIndex = 0;
function showOpinion(){ 
  document.getElementById('opiniaText').textContent = opinie[opinIndex]; 
  opinIndex=(opinIndex+1)%opinie.length; 
}
showOpinion(); 
setInterval(showOpinion,4500);

// =========================
// NOWA MAPA I CZATBOT
// =========================

/* ---------- SETTINGS ---------- */
const PRICE_PER_KM = 2.0;          // PLN per km base
const NIGHT_SURCHARGE = 0.30;      // 30% more night hours
const HIGHWAY_SURCHARGE = 0.15;    // 15% if autopays assumed
const MIN_FARE = 120;              // minimal fee

/* ---------- HELPERS ---------- */
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
function esc(s=''){ return String(s||'').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ---------- MAP (Leaflet) ---------- */
const map = L.map('map', { zoomControl:true }).setView([52.2297,21.0122], 7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:19, attribution:'¬© OpenStreetMap contributors' }).addTo(map);
let routeLayer = null;
let tempMarker = null;

/* geocode via Nominatim */
async function geocode(query){
  const url = 'https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(query);
  try{
    const r = await fetch(url, { headers:{ 'Accept':'application/json' }});
    const data = await r.json();
    return data;
  }catch(e){ console.error(e); return []; }
}

/* use OSRM for routing (public demo) */
async function routeBetween(lat1,lon1,lat2,lon2){
  // OSRM expects lon,lat pairs
  const url = `https://router.project-osrm.org/route/v1/driving/${lon1},${lat1};${lon2},${lat2}?overview=full&geometries=geojson&annotations=distance,duration`;
  try{
    const r = await fetch(url);
    if(!r.ok) throw new Error('OSRM error');
    const data = await r.json();
    if(data.code !== 'Ok' || !data.routes || data.routes.length===0) return null;
    return data.routes[0];
  }catch(e){ console.warn('Routing failed', e); return null; }
}

/* calculate price from distance (meters) and options */
function estimatePriceFromMeters(meters, options={}){
  const km = meters/1000;
  let base = Math.max(MIN_FARE, km * PRICE_PER_KM);
  // time-based surcharges (options.night boolean)
  if(options.night) base *= (1 + NIGHT_SURCHARGE);
  if(options.highway) base *= (1 + HIGHWAY_SURCHARGE);
  return Math.round(base);
}

/* ---------- UI: search box -> geocode -> marker -------- */
const searchBox = document.getElementById('searchBox');
searchBox.addEventListener('keypress', async (e) => {
  if(e.key !== 'Enter') return;
  const q = searchBox.value.trim();
  if(!q) return;
  const res = await geocode(q);
  if(!res || res.length===0){ alert('Nie znaleziono adresu. Spr√≥buj bardziej precyzyjnie (ulica, miasto).'); return; }
  const place = res[0];
  const lat = parseFloat(place.lat), lon = parseFloat(place.lon);
  if(tempMarker) map.removeLayer(tempMarker);
  tempMarker = L.marker([lat,lon]).addTo(map).bindPopup(esc(place.display_name)).openPopup();
  map.setView([lat,lon], 15);
});

/* Convenience: if user writes "SkƒÖd ‚Üí DokƒÖd" in chat, bot will compute route */
async function showRouteFromString(str){
  // expected formats: "Pozna≈Ñ ‚Üí Berlin", "ul. D≈Çuga 5 Pozna≈Ñ -> ul. ...", "skƒÖd;dokƒÖd"
  const arrows = ['‚Üí','->','‚Äî','‚Äì','>','‚áí'];
  let parts = null;
  for(const a of arrows){
    if(str.includes(a)){ parts = str.split(a).map(s=>s.trim()); break; }
  }
  if(!parts){
    // try " do "
    if(str.toLowerCase().includes(' do ')) parts = str.split(/ do /i).map(s=>s.trim());
  }
  if(!parts || parts.length<2) { return null; }
  const fromQ = parts[0], toQ = parts[1];
  const fromRes = await geocode(fromQ);
  const toRes = await geocode(toQ);
  if(!fromRes.length || !toRes.length) return { error:'Nie znaleziono jednego z adres√≥w.' };
  const f = fromRes[0], t = toRes[0];
  const fLat = parseFloat(f.lat), fLon = parseFloat(f.lon);
  const tLat = parseFloat(t.lat), tLon = parseFloat(t.lon);
  const route = await routeBetween(fLat,fLon,tLat,tLon);
  if(!route) return { error:'Nie uda≈Ço siƒô wyznaczyƒá trasy.' };

  // draw route
  if(routeLayer) map.removeLayer(routeLayer);
  routeLayer = L.geoJSON(route.geometry, { style: { color:'#4FA3FF', weight:4, opacity:0.9 } }).addTo(map);
  // fit bounds
  const coords = route.geometry.coordinates.map(c => [c[1], c[0]]);
  map.fitBounds(coords, { padding:[40,40] });

  // markers
  if(tempMarker) map.removeLayer(tempMarker);
  const m1 = L.marker([fLat,fLon]).addTo(map).bindPopup(esc(f.display_name));
  const m2 = L.marker([tLat,tLon]).addTo(map).bindPopup(esc(t.display_name));
  tempMarker = L.layerGroup([m1,m2]).addTo(map);

  return { route, from: f, to: t };
}

/* ---------- CHATBOT LOGIC ---------- */

// language support (simple)
let LANG = 'pl'; // 'pl','en','de','nl' - default pl
const langBtn = document.getElementById('langBtn');
langBtn.addEventListener('click', ()=>{
  const order = ['pl','en','de','nl'];
  LANG = order[(order.indexOf(LANG)+1)%order.length];
  langBtn.textContent = LANG.toUpperCase();
  botAddMessage(getResponseText('greeting'));
});

// quick actions
document.querySelectorAll('.quick-action').forEach(el=>{
  el.addEventListener('click', ()=> {
    const q = el.dataset.q;
    document.getElementById('cbInput').value = q;
    document.getElementById('cbSend').click();
  });
});

const cbToggle = document.querySelector('.chatbot-toggle');
const cbWindow = document.querySelector('.chatbot-window');
const cbClose = document.getElementById('chatClose');
const cbMessages = document.getElementById('cbMessages');
const cbInput = document.getElementById('cbInput');
const cbSend = document.getElementById('cbSend');
const cbTyping = document.getElementById('cbTyping');

cbToggle.addEventListener('click', ()=>{ cbWindow.style.display='flex'; cbToggle.style.display='none'; botSystemIntro(); });
cbClose.addEventListener('click', ()=>{ cbWindow.style.display='none'; cbToggle.style.display='flex'; });

cbSend.addEventListener('click', ()=>{ handleUserMessage(cbInput.value.trim()); cbInput.value=''; });
cbInput.addEventListener('keypress', (e)=>{ if(e.key==='Enter'){ cbSend.click(); }});

// start message
function botSystemIntro(){
  if(cbMessages.children.length===0) botAddMessage(getResponseText('greeting') + ' ' + getResponseText('help'));
}

/* add message */
function botAddMessage(text, from='bot'){
  const d = document.createElement('div');
  d.className = 'message ' + (from==='user' ? 'user' : 'bot');
  d.innerHTML = text;
  cbMessages.appendChild(d);
  cbMessages.scrollTop = cbMessages.scrollHeight;
}

/* language-based canned responses */
const canned = {
  pl: {
    greeting: `Cze≈õƒá! Jestem Asystent ${OWNER_DATA.formalName}. üòä`,
    help: `Pomogƒô Ci z wycenƒÖ, rezerwacjƒÖ trasy, zasadami bezpiecze≈Ñstwa. Bezpo≈õredni kontakt: ${OWNER_DATA.phone}`,
    unknown: `Przepraszam, nie zrozumia≈Çem. Mo≈ºesz zapytaƒá o wycenƒô lub zadzwoniƒá bezpo≈õrednio do ${OWNER_DATA.name} - ${OWNER_DATA.phone}`,
    booking_confirm: `Zarezerwowa≈Çem wstƒôpnie‚Äî${OWNER_DATA.name} potwierdzi telefonicznie. Chcesz abym zebra≈Ç dane teraz?`,
    available_none: 'Brak dostƒôpnych termin√≥w na wskazany dzie≈Ñ.',
    contact: `Kontakt bezpo≈õredni:<br>üìû ${OWNER_DATA.phone}<br>‚úâÔ∏è ${OWNER_DATA.email}`
  },
  en: {
    greeting: `Hi! I am ${OWNER_DATA.name} Assistant. üòä`,
    help: `I can help with price estimates, booking routes, safety rules. Direct contact: ${OWNER_DATA.phone}`,
    unknown: `Sorry, I didn't get that. Try 'price Poznan to Berlin' or call ${OWNER_DATA.name} directly at ${OWNER_DATA.phone}`,
    booking_confirm: 'Provisional booking created ‚Äî driver will confirm by phone. Collect details now?',
    available_none: 'No availability for the selected date.',
    contact: `Direct contact:<br>üìû ${OWNER_DATA.phone}<br>‚úâÔ∏è ${OWNER_DATA.email}`
  },
  de: {
    greeting: `Hallo! Ich bin ${OWNER_DATA.name} Assistent. üòä`,
    help: `Ich helfe bei Preisberechnungen, Buchungen, Sicherheitsregeln. Direktkontakt: ${OWNER_DATA.phone}`,
    unknown: 'Entschuldigung, ich habe das nicht verstanden.',
    booking_confirm: 'Vorl√§ufige Buchung erstellt ‚Äî Fahrer best√§tigt telefonisch. Daten jetzt sammeln?',
    available_none: 'Keine Verf√ºgbarkeit an diesem Datum.',
    contact: `Direktkontakt:<br>üìû ${OWNER_DATA.phone}<br>‚úâÔ∏è ${OWNER_DATA.email}`
  },
  nl: {
    greeting: `Hoi! Ik ben ${OWNER_DATA.name} Assistent. üòä`,
    help: `Ik help met prijsinschatting, routeboekingen, veiligheidsregels. Direct contact: ${OWNER_DATA.phone}`,
    unknown: 'Sorry, dat begreep ik niet.',
    booking_confirm: 'Voorlopige boeking gemaakt ‚Äî chauffeur bevestigt telefonisch. Gegevens nu verzamelen?',
    available_none: 'Geen beschikbaarheid op die datum.',
    contact: `Direct contact:<br>üìû ${OWNER_DATA.phone}<br>‚úâÔ∏è ${OWNER_DATA.email}`
  }
};

function getResponseText(key){
  return canned[LANG] && canned[LANG][key] ? canned[LANG][key] : canned.pl[key];
}

/* BOT knowledge (big set) */
const BOT_KB = {
  driver: {
    name: OWNER_DATA.formalName,
    desc: 'W≈Ça≈õciciel firmy z 12-letnim do≈õwiadczeniem. Specjalizowane trasy PL‚ÜîDE/NL/BE. Kurs pierwszej pomocy, certyfikat przewozu os√≥b.'
  },
  safety: [
    'Pasy bezpiecze≈Ñstwa obowiƒÖzkowe dla wszystkich pasa≈ºer√≥w.',
    'Regularne przeglƒÖdy techniczne co 30 dni.',
    'Pe≈Çne ubezpieczenie OC/AC + NNW.',
    'Zakaz spo≈ºywania alkoholu i ≈õrodk√≥w odurzajƒÖcych w poje≈∫dzie.',
    'Dezynfekcja pojazdu przed ka≈ºdym kursem.'
  ],
  faq: {
    'faktura': 'Wystawiamy faktury VAT na ≈ºyczenie ‚Äî podaj dane do faktury przy rezerwacji.',
    'baga≈º': 'Standardowo 20 kg na osobƒô + ma≈Çy baga≈º podrƒôczny. Wiƒôkszy baga≈º po uzgodnieniu.',
    'zwierzƒôta': 'Ma≈Çe zwierzƒôta przewozimy w transporterach za dop≈ÇatƒÖ 40‚Äì60 PLN.',
    'rower': 'Przew√≥z roweru mo≈ºliwy po wcze≈õniejszym zg≈Çoszeniu (+50 PLN).',
    'dziecko': 'Foteliki dzieciƒôce dostƒôpne za dop≈ÇatƒÖ 30 PLN ‚Äî powiedz przy rezerwacji.',
    'zaliczka': 'Zaliczka 50% opcjonalnie; zasady p≈Çatno≈õci ustalane przy rezerwacji.',
    'kontakt': `Bezpo≈õredni kontakt z w≈Ça≈õcicielem:<br>üìû ${OWNER_DATA.phone}<br>‚úâÔ∏è ${OWNER_DATA.email}`
  },
  hits: [
    'Hit: Express Berlin ‚Äî szybkie po≈ÇƒÖczenia w promocji!',
    'Voucher -30% dla klient√≥w kt√≥rzy zam√≥wiƒÖ 3x w miesiƒÖcu.',
    'Nocne przejazdy -20% (po 22:00).',
    'Stali klienci - dodatkowe rabaty!'
  ]
};

/* natural-language handler (simple heuristics) */
async function handleUserMessage(raw){
  if(!raw) return;
  botAddMessage(esc(raw), 'user');
  cbTyping.style.display = 'block';

  // small delay
  await sleep(400 + Math.random()*600);

  // process
  const text = raw.toLowerCase();

  // direct route request: "Pozna≈Ñ -> Berlin" or "SkƒÖd -> DokƒÖd"
  if(/‚Üí|->|do|->| to /i.test(text) && (text.includes('‚Üí') || text.includes('->') || text.includes(' do ') || text.includes(' to '))){
    const result = await showRouteFromString(raw);
    cbTyping.style.display='none';
    if(!result) { botAddMessage(getResponseText('unknown')); return; }
    if(result.error){ botAddMessage(esc(result.error)); return; }

    // present summary: distance/time/price
    const meters = result.route.distance;
    const seconds = result.route.duration;
    const price = estimatePriceFromMeters(meters, { night: isNightTime(), highway:true });
    const distKm = (meters/1000).toFixed(1);
    const timeMin = Math.round(seconds/60);

    const reply = `
      Trasa: <b>${esc(result.from.display_name.split(',')[0])} ‚Üí ${esc(result.to.display_name.split(',')[0])}</b><br>
      Dystans: <b>${distKm} km</b>, Szac. czas: <b>${timeMin} min</b>.<br>
      Szac. cena: <b>${price} PLN</b> (orientacyjnie).<br>
      <span class="chat-link" onclick="startBookingFromRoute('${escape(JSON.stringify(result.from))}','${escape(JSON.stringify(result.to))}','${meters}','${seconds}')">Zarezerwuj tƒô trasƒô</span>
    `;
    botAddMessage(reply);
    return;
  }

  // keywords
  if(/cze≈õƒá|hej|witam|dzie≈Ñ dobry/.test(text)){ cbTyping.style.display='none'; botAddMessage(getResponseText('greeting')); return; }
  if(/ile koszt|cena|koszt/.test(text)){
    // try to detect city name, else ask for route
    const cities = ['berlin','warszawa','krak√≥w','wroc≈Çaw','gda≈Ñsk','poznan'];
    for(const c of cities){ if(text.includes(c)){ const price = BOT_KB.hits.includes(c)?'promocyjna' : 'orientacyjna'; botAddMessage(`Przejazd do ${c.charAt(0).toUpperCase()+c.slice(1)}: orientacyjnie  ${estimateCityRange(c)} PLN.`); cbTyping.style.display='none'; return; } }
    cbTyping.style.display='none'; botAddMessage('Podaj proszƒô trasƒô (SkƒÖd ‚Üí DokƒÖd) lub miasto docelowe, a policzƒô przybli≈ºonƒÖ cenƒô.'); return;
  }
  if(/rezerw|zarezerwuj|book/.test(text)){
    cbTyping.style.display='none';
    botAddMessage(getResponseText('booking_confirm'));
    // start booking flow
    await sleep(300);
    startBookingFlow();
    return;
  }
  if(/kierowc|mariusz|maniek|krawczyk/.test(text)){ cbTyping.style.display='none'; botAddMessage(`<b>${BOT_KB.driver.name}</b><br>${BOT_KB.driver.desc}<br><br>${getResponseText('contact')}`); return; }
  if(/pasy|bezpiecze|zasad/.test(text)){ cbTyping.style.display='none'; botAddMessage(BOT_KB.safety.map(s=>'‚Ä¢ '+s).join('<br>')); return; }
  if(/hit|trend|polec|promoc/.test(text)){ cbTyping.style.display='none'; botAddMessage(BOT_KB.hits[Math.floor(Math.random()*BOT_KB.hits.length)]); return; }
  if(/kontakt|telefon|mail|email/.test(text)){ cbTyping.style.display='none'; botAddMessage(getResponseText('contact')); return; }

  // faq match
  for(const k of Object.keys(BOT_KB.faq)){
    if(text.includes(k)){ cbTyping.style.display='none'; botAddMessage(BOT_KB.faq[k]); return; }
  }

  // check availability question
  if(/dostƒôp|wolne|terminy|termin/.test(text)){
    const arr = loadReservations();
    cbTyping.style.display='none';
    botAddMessage(`Aktualnie zapisane rezerwacje: <b>${arr.length}</b>. Mo≈ºesz podaƒá datƒô (YYYY-MM-DD) a sprawdzƒô dostƒôpno≈õƒá.`);
    return;
  }

  // fallback
  cbTyping.style.display='none';
  botAddMessage(getResponseText('unknown'));
}

/* small pricing helper for city keywords (simple approximations) */
function estimateCityRange(city){
  const map = {
    berlin: '350-450',
    warszawa: '250-350',
    krak√≥w: '200-300',
    wroc≈Çaw: '180-280',
    gda≈Ñsk: '300-400',
    poznan: '120-220'
  };
  return map[city] || 'do ustalenia';
}

/* crude night-time detection */
function isNightTime(){
  const h = new Date().getHours();
  return (h < 6 || h >= 22);
}

/* ---------- BOOKING FLOW (chat-driven) ---------- */
let bookingContext = null;

async function startBookingFlow(prefill={}){
  bookingContext = { step:0, data: Object.assign({ name:'', phone:'', email:'', from:'', to:'', date:'', people:1, notes:'' }, prefill) };
  await askBookingQuestion();
}

async function askBookingQuestion(){
  if(!bookingContext) return;
  const qmap = [
    { key:'from', q:'SkƒÖd jedziesz? (np. Pozna≈Ñ, ul. ...)' },
    { key:'to', q:'DokƒÖd jedziesz?' },
    { key:'date', q:'Podaj datƒô i godzinƒô (YYYY-MM-DD HH:mm)' },
    { key:'people', q:'Ile os√≥b?' },
    { key:'name', q:'Twoje imiƒô i nazwisko?' },
    { key:'phone', q:'Numer telefonu (najlepiej +48 ...)?' },
    { key:'email', q:'E-mail (opcjonalnie)?' },
    { key:'notes', q:'Dodatkowe uwagi? (baga≈º, fotelik...)' }
  ];
  if(bookingContext.step >= qmap.length){
    // finalize
    finalizeBooking();
    return;
  }
  const cur = qmap[bookingContext.step];
  botAddMessage(cur.q);
  // wait for user input via chat - override cbSend handler temporarily
  const handler = async () => {
    const val = cbInput.value.trim();
    if(!val){ botAddMessage('Proszƒô podaj warto≈õƒá.'); return; }
    bookingContext.data[cur.key] = val;
    cbInput.value='';
    bookingContext.step++;
    // restore normal handler and continue
    await askBookingQuestion();
  };

  // we replace the send handler once to capture next answer
  const old = cbSend.onclick;
  cbSend.onclick = handler;
  // also Enter key - we rely on default enter->click
  // when booking completes, restore handler inside finalizeBooking
}

/* finalize booking: save local + show summary + offer email/send via EmailJS if configured */
async function finalizeBooking(){
  // restore send handler
  cbSend.onclick = ()=>{ handleUserMessage(cbInput.value.trim()); cbInput.value=''; };

  const data = bookingContext.data;
  // convert date if possible
  let dateIso = data.date;
  // attempt parsing "YYYY-MM-DD HH:mm"
  try {
    if(/\d{4}-\d{2}-\d{2}/.test(data.date)){
      const d = new Date(data.date.replace(' ','T'));
      if(!isNaN(d)) dateIso = d.toISOString();
    }
  }catch(e){}
  const r = {
    id: 'r_' + Date.now(),
    name: data.name || 'Anon',
    phone: data.phone || '',
    email: data.email || '',
    from: data.from || '',
    to: data.to || '',
    date: dateIso || new Date().toISOString(),
    people: data.people || 1,
    notes: data.notes || '',
    status: 'pending',
    created_at: new Date().toISOString()
  };

  const arr = loadReservations();
  arr.unshift(r);
  saveReservations(arr);

  // WYSY≈ÅANIE EMAILA DO W≈ÅA≈öCICIELA
  sendEmailToOwner(r);

  // show summary + price estimate if route resolvable
  let priceText = 'Cena orientacyjna: nieznana (brak trasy)';
  // try to geocode route and price
  try{
    const res = await showRouteFromString(`${r.from} ‚Üí ${r.to}`);
    if(res && !res.error){
      const meters = res.route.distance;
      const p = estimatePriceFromMeters(meters, { night: isNightTime(), highway:true });
      priceText = `Szacunkowa cena: <b>${p} PLN</b> (dystans ${(meters/1000).toFixed(1)} km).`;
    }
  }catch(e){ console.warn(e); }

  botAddMessage(`Dziƒôkujƒô ‚Äî rezerwacja zapisana i wys≈Çana do w≈Ça≈õciciela. ${priceText} ${OWNER_DATA.name} skontaktuje siƒô telefonicznie w celu potwierdzenia.`);
  bookingContext = null;
}

/* helper used in route reply to start booking with route prefilled */
window.startBookingFromRoute = async function(fromJSON,toJSON,meters,seconds){
  const fromObj = JSON.parse(unescape(fromJSON));
  const toObj = JSON.parse(unescape(toJSON));
  const fromStr = fromObj.display_name ? fromObj.display_name.split(',')[0] : (fromObj.name||fromObj.address||'');
  const toStr = toObj.display_name ? toObj.display_name.split(',')[0] : (toObj.name||toObj.address||'');
  startBookingFlow({ from: fromStr, to: toStr });
  botAddMessage('Rozpoczynam proces rezerwacji z predefiniowanƒÖ trasƒÖ. Podaj kolejne dane proszƒô.');
}

/* ---------- init: greet + quick info ---------- */
function initBotUI(){
  // greeting message
  botAddMessage(`<b>${BOT_KB.driver.name}</b> ‚Äî ${BOT_KB.driver.desc}`);
  botAddMessage(getResponseText('greeting') + ' ' + getResponseText('help'));
  // show top FAQ as hints
  botAddMessage('Mo≈ºesz zapytaƒá o: <i>cena</i>, <i>rezerwacja</i>, <i>bezpiecze≈Ñstwo</i>, <i>baga≈º</i>, <i>kontakt</i>, <i>hit sezonu</i>.');
}
initBotUI();

// =========================
// ORYGINALNA FUNKCJONALNO≈öƒÜ FORMULARZA
// =========================

// --- Walidacja formularza ---
function validateForm() {
  let isValid = true;
  
  // Reset errors
  document.querySelectorAll('.form-error').forEach(el => {
    el.style.display = 'none';
  });
  
  // Name validation
  const name = document.getElementById('name').value.trim();
  if (!name) {
    document.getElementById('nameError').style.display = 'block';
    isValid = false;
  }
  
  // Phone validation
  const phone = document.getElementById('phone').value.trim();
  const phoneRegex = /^[\+]?[0-9\s\-\(\)]{9,}$/;
  if (!phone || !phoneRegex.test(phone)) {
    document.getElementById('phoneError').style.display = 'block';
    isValid = false;
  }
  
  // Email validation (optional)
  const email = document.getElementById('email').value.trim();
  if (email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      document.getElementById('emailError').style.display = 'block';
      isValid = false;
    }
  }
  
  // From validation
  const from = document.getElementById('from').value.trim();
  if (!from) {
    document.getElementById('fromError').style.display = 'block';
    isValid = false;
  }
  
  // To validation
  const to = document.getElementById('to').value.trim();
  if (!to) {
    document.getElementById('toError').style.display = 'block';
    isValid = false;
  }
  
  // Date validation
  const date = document.getElementById('date').value;
  if (!date) {
    document.getElementById('dateError').style.display = 'block';
    isValid = false;
  }
  
  // People validation
  const people = document.getElementById('people').value;
  if (!people || people < 1 || people > 8) {
    document.getElementById('peopleError').style.display = 'block';
    isValid = false;
  }
  
  return isValid;
}

// --- Reszta funkcjonalno≈õci ---
const form = document.getElementById('bookingForm');
const formStatus = document.getElementById('formStatus');

form.addEventListener('submit', function(e){
  e.preventDefault();
  
  if (!validateForm()) {
    formStatus.textContent = 'Proszƒô poprawiƒá b≈Çƒôdy w formularzu.';
    formStatus.style.color = '#ff6b6b';
    setTimeout(()=>formStatus.textContent='','3500');
    return;
  }
  
  const r = {
    id: 'r_' + Date.now(),
    name: document.getElementById('name').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    email: document.getElementById('email').value.trim(),
    from: document.getElementById('from').value.trim(),
    to: document.getElementById('to').value.trim(),
    date: document.getElementById('date').value,
    people: document.getElementById('people').value,
    notes: document.getElementById('notes').value.trim(),
    status: 'pending',
    created_at: new Date().toISOString()
  };

  const arr = loadReservations();
  arr.unshift(r);
  saveReservations(arr);

  // WYSY≈ÅANIE EMAILA DO W≈ÅA≈öCICIELA
  sendEmailToOwner(r);

  formStatus.textContent = 'Rezerwacja zapisana i wys≈Çana do w≈Ça≈õciciela!';
  formStatus.style.color = '#4CAF50';
  form.reset();
  setTimeout(()=>formStatus.textContent='','4200');

  renderReservationsTable(); 
});

// Panel kierowcy
const panelArea = document.getElementById('panelArea');
const panelLoginBtn = document.getElementById('panelLogin');
const panelPassInput = document.getElementById('panelPass');
const openPanelBtn = document.getElementById('openPanelBtn');
const openPanelMobile = document.getElementById('openPanelMobile');
const reservationsList = document.getElementById('reservationsList');
const welcomeMessage = document.getElementById('welcomeMessage');

let isLoggedIn = false;

function showPanelUI(){
  panelArea.style.display='block';
  document.getElementById('panelPass').focus();
}

openPanelBtn.addEventListener('click', ()=>{ 
  showPanelUI(); 
  window.scrollTo({top:0,behavior:'smooth'}); 
});

openPanelMobile.addEventListener('click', ()=>{ 
  showPanelUI(); 
  window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'}); 
});

panelLoginBtn.addEventListener('click', ()=> {
  const pass = panelPassInput.value || '';
  if(pass === SECRET_PASS){
    isLoggedIn = true;
    document.getElementById('panelPass').value = '';
    renderReservationsTable();
    document.getElementById('panelPass').placeholder = 'Zalogowano';
    panelLoginBtn.textContent = 'Od≈õwie≈º';
    welcomeMessage.textContent = `Cze≈õƒá ${OWNER_DATA.name}! Witaj w panelu kierowcy.`;
    welcomeMessage.classList.remove('hidden');
  } else {
    alert('B≈Çƒôdne has≈Ço.');
  }
});

function renderReservationsTable(){
  const arr = loadReservations();
  if(arr.length===0){
    reservationsList.innerHTML = '<div class="small muted">Brak rezerwacji.</div>';
    return;
  }

  let html = '<div style="overflow:auto;"><table><thead><tr><th>Imiƒô</th><th>Tel</th><th>Trasa</th><th>Data</th><th>Os√≥b</th><th>Uwagi</th><th>Status</th></tr></thead><tbody>';
  arr.forEach(r=>{
    html += `<tr id="${r.id}"><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.phone)}</td><td>${escapeHtml(r.from)} ‚Üí ${escapeHtml(r.to)}</td><td>${new Date(r.date).toLocaleString()}</td><td>${escapeHtml(r.people)}</td><td>${escapeHtml(r.notes)}</td><td><select data-id="${r.id}" onchange="changeStatus(this)"><option ${r.status==='pending'?'selected':''}>pending</option><option ${r.status==='accepted'?'selected':''}>accepted</option><option ${r.status==='rejected'?'selected':''}>rejected</option></select></td></tr>`;
  });
  html += '</tbody></table></div>';
  reservationsList.innerHTML = html;
}

window.changeStatus = function(sel){
  const id = sel.dataset.id;
  const newStatus = sel.value;
  let arr = loadReservations();
  arr = arr.map(r => r.id===id ? Object.assign({}, r, {status:newStatus}) : r);
  saveReservations(arr);
  renderReservationsTable();
};

document.getElementById('exportCsv').addEventListener('click', ()=> {
  const arr = loadReservations();
  if(arr.length===0){ alert('Brak rezerwacji do eksportu.'); return; }
  const header = ['id','name','phone','email','from','to','date','people','notes','status','created_at'];
  const rows = arr.map(r => header.map(h => `"${(r[h]||'').toString().replace(/"/g,'""')}"`).join(','));
  const csv = [header.join(','), ...rows].join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; 
  a.download = 'rezerwacje_maniek.csv'; 
  document.body.appendChild(a); 
  a.click(); 
  a.remove();
  URL.revokeObjectURL(url);
});

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('UsunƒÖƒá wszystkie lokalne rezerwacje?')) return;
  localStorage.removeItem(STORAGE_KEY);
  renderReservationsTable();
});

renderReservationsTable();

function escapeHtml(s=''){ 
  return String(s).replace(/[&<>"']/g, function(m){ 
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; 
  }); 
}

/* ---------- small helper to escape in HTML attributes ---------- */
function escape(s=''){ return String(s).replace(/"/g,'&quot;').replace(/'/g,"&#39;"); }

/* ---------- utility: small function to add user messages (for flows) ---------- */
function addUserText(text){ botAddMessage(esc(text),'user'); }

/* ---------- expose some functions to console if needed ---------- */
window.maniek = {
  estimateFromRouteString: async (s)=> {
    const res = await showRouteFromString(s);
    if(!res || res.error) return res;
    return {
      distance_km: (res.route.distance/1000).toFixed(2),
      duration_min: Math.round(res.route.duration/60),
      price_pln: estimatePriceFromMeters(res.route.distance, { night:isNightTime(), highway:true })
    };
  },
  listReservations: () => loadReservations(),
  owner: OWNER_DATA
};
</script>

</body>
</html>

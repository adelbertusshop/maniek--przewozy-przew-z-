<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Maniek ‚Äî Pewny Przew√≥z | Mariusz Krawczyk</title>

<style>
  :root{
    --bg-deep:#0f1724;
    --card:#172433;
    --accent:#4FA3FF;
    --accent-2:#DAA520;
    --muted:#9fb3d6;
    --white:#ffffff;
  }

  *{box-sizing:border-box; margin:0; padding:0;}
  body{
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg, rgba(11,19,33,0.94) 0%, rgba(9,13,22,0.92) 100%), url('https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat fixed;
    color:var(--white);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding-bottom:60px;
    min-height:100vh;
  }

  header{
    background: rgba(27,42,65,0.95);
    border-bottom: 1px solid rgba(79,163,255,0.08);
    padding:12px 16px;
    position:sticky;
    top:0;
    z-index:100;
    backdrop-filter: blur(10px);
  }
  
  .container{ 
    max-width:1100px; 
    margin:0 auto; 
    padding:0 16px; 
    width:100%;
  }
  
  .brand{ 
    display:flex; 
    align-items:center; 
    gap:10px; 
    flex-wrap:wrap;
  }
  
  .logo {
    width:44px;
    height:44px;
    border-radius:8px;
    background:linear-gradient(135deg,var(--accent),#2b6ce3);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#0b1724;
    box-shadow:0 3px 14px rgba(11,19,33,0.5);
    flex-shrink:0;
  }
  
  .brand h1{ 
    margin:0; 
    font-size:clamp(14px, 4vw, 16px);
    line-height:1.2;
  }
  
  .brand p{ 
    margin:0;
    font-size:clamp(10px, 3vw, 12px);
    color:var(--muted);
    width:100%;
  }

  nav{ 
    margin-left:auto; 
    display:flex; 
    gap:8px; 
    align-items:center;
    flex-wrap:wrap;
  }
  
  .btn {
    background:transparent;
    border:1px solid rgba(255,255,255,0.06); 
    color:var(--white);
    padding:6px 10px;
    border-radius:6px;
    font-weight:600;
    cursor:pointer;
    text-decoration:none;
    font-size:12px;
    white-space:nowrap;
    transition: all 0.3s ease;
  }
  
  .btn:hover {
    background: rgba(255,255,255,0.05);
  }
  
  .btn.primary{ 
    background:var(--accent); 
    color:#072033; 
    border:none; 
  }
  
  .btn.primary:hover {
    background: #3a8de6;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79,163,255,0.3);
  }
  
  .btn.ghost{ background:transparent; }

  main{ 
    padding:20px 0;
    min-height:calc(100vh - 200px);
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr;
    gap:16px;
    align-items:start;
  }

  @media (min-width: 768px) {
    .grid{ 
      grid-template-columns: 1fr 360px;
      gap:20px;
    }
    
    .brand p{
      width:auto;
    }
    
    .btn {
      padding:8px 12px;
      font-size:14px;
    }
    
    header {
      padding:16px;
    }
  }

  @media (max-width: 480px) {
    nav{ 
      display:none; 
    }
    
    .brand {
      justify-content:center;
      text-align:center;
    }
  }

  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:16px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    border:1px solid rgba(255,255,255,0.03);
    width:100%;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(2,6,23,0.8);
  }

  h2{ 
    margin:0 0 10px 0; 
    color:var(--accent); 
    font-size:clamp(16px, 4vw, 18px);
  }
  
  label{ 
    display:block; 
    font-size:13px; 
    color:var(--muted); 
    margin-bottom:6px; 
  }
  
  input[type=text], input[type=email], input[type=tel], input[type=datetime-local], textarea, select, input[type=number]{
    width:100%; 
    padding:10px 12px; 
    border-radius:8px; 
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02); 
    color:var(--white); 
    outline:none; 
    font-size:14px;
    min-height:44px;
    transition: border 0.3s ease;
  }
  
  input:focus, textarea:focus, select:focus {
    border-color: var(--accent);
  }
  
  textarea{ 
    min-height:90px; 
    resize:vertical; 
  }

  .form-row{ 
    display:flex; 
    flex-direction:column;
    gap:10px; 
  }
  
  .form-row .col{ 
    flex:1; 
    width:100%;
  }

  @media (min-width: 480px) {
    .form-row{
      flex-direction:row;
    }
  }

  .submit {
    display:inline-block;
    padding:12px 16px;
    border-radius:10px;
    border:none;
    background:linear-gradient(90deg,var(--accent),#2b6ce3);
    color:#021224;
    font-weight:700;
    cursor:pointer;
    margin-top:8px;
    font-size:14px;
    min-height:44px;
    width:100%;
    transition: all 0.3s ease;
  }

  .submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(79,163,255,0.4);
  }

  @media (min-width: 480px) {
    .submit {
      width:auto;
    }
  }

  .muted{ color:var(--muted); font-size:13px; margin-top:8px; }

  .panel-title{ display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; }
  table{ width:100%; border-collapse:collapse; margin-top:12px; font-size:14px; overflow-x:auto; display:block; }
  th,td{ padding:8px 10px; border-bottom:1px dashed rgba(255,255,255,0.04); text-align:left; white-space:nowrap; }
  th{ color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:0.6px; }

  .chip{ background:rgba(255,255,255,0.03); padding:6px 10px; border-radius:999px; font-size:13px; display:inline-block; color:var(--muted); }

  .icons-row{ 
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap:10px;
    justify-content:center;
    margin:14px 0;
  }
  
  .icon-box{ 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    gap:6px; 
    padding:12px; 
    border-radius:10px; 
    background:rgba(255,255,255,0.02); 
    text-align:center;
    min-height:80px;
    transition: transform 0.3s ease, background 0.3s ease;
  }
  
  .icon-box:hover {
    transform: translateY(-5px);
    background: rgba(255,255,255,0.05);
  }
  
  .icon-emoji{ font-size:24px; }

  footer{ 
    text-align:center; 
    color:var(--muted); 
    padding:20px 8px; 
    margin-top:20px; 
    font-size:13px;
  }
  
  .small{ font-size:13px;color:var(--muted); }

  .opinie{ font-style:italic; opacity:0.95; font-size:15px; line-height:1.4; }
  .opinie-wrap{ display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap; }

  .ribbon{ 
    position:fixed; 
    right:10px; 
    bottom:70px; 
    background:var(--accent-2); 
    color:#072033; 
    padding:8px 12px; 
    border-radius:999px; 
    font-weight:700; 
    box-shadow:0 6px 18px rgba(10,14,25,0.6); 
    z-index:60;
    font-size:12px;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  .hidden { display: none !important; }
  
  .contact-info {
    background: linear-gradient(135deg, rgba(79,163,255,0.1), rgba(218,165,32,0.1));
    border: 1px solid rgba(79,163,255,0.2);
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
    text-align: center;
  }
  
  .contact-info h3 {
    color: var(--accent);
    margin-bottom: 10px;
    font-size: 18px;
  }
  
  .contact-links {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
  }
  
  .contact-link {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--white);
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
    transition: all 0.3s ease;
    font-size: 14px;
  }
  
  .contact-link:hover {
    background: var(--accent);
    color: #072033;
    transform: translateY(-2px);
  }
  
  .owner-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, var(--accent-2), #b8860b);
    color: #072033;
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 12px;
    margin-left: 8px;
  }

  .success-message {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    text-align: center;
    animation: fadeIn 0.5s ease;
  }

  @media (min-width: 768px) {
    .contact-links {
      flex-direction: row;
      justify-content: center;
    }
  }
</style>
</head>
<body>

<header>
  <div class="container" style="display:flex;align-items:center;justify-content:space-between;">
    <div class="brand">
      <div class="logo">MP</div>
      <div>
        <h1>Maniek ‚Äî Pewny Przew√≥z <span class="owner-badge">Mariusz Krawczyk</span></h1>
        <p>Bezpiecznie. Na czas. Zawsze. | Tel: +48 575 686 277</p>
      </div>
    </div>

    <nav>
      <a class="btn" href="#kierowca">O kierowcy</a>
      <a class="btn" href="#bezpieczenstwo">Bezpiecze≈Ñstwo</a>
      <a class="btn" href="#opinie">Opinie</a>
      <a class="btn primary" id="openPanelBtn">Panel kierowcy</a>
    </nav>
  </div>
</header>

<main class="container">
  <div class="grid">
    <div>
      <div class="card">
        <h2>Zarezerwuj przejazd</h2>
        <p class="small muted">Wype≈Çnij formularz ‚Äî rezerwacja wy≈õle email do Mariusza!</p>

        <div class="contact-info">
          <h3>üìû Bezpo≈õredni kontakt z w≈Ça≈õcicielem</h3>
          <div class="contact-links">
            <a href="tel:+48575686277" class="contact-link">
              <span>üìû</span> +48 575 686 277
            </a>
            <a href="mailto:mariusz.krawczyk7.88@gmail.com" class="contact-link">
              <span>‚úâÔ∏è</span> mariusz.krawczyk7.88@gmail.com
            </a>
          </div>
        </div>

        <!-- Powiadomienie o wys≈Çaniu -->
        <div id="emailSuccess" class="success-message" style="display:none;">
          ‚úÖ Rezerwacja wys≈Çana! Email zosta≈Ç dostarczony do Mariusza.
        </div>

        <form id="bookingForm" autocomplete="off">
          <div style="margin-top:12px;">
            <label for="name">Imiƒô i nazwisko *</label>
            <input id="name" type="text" required placeholder="Jan Kowalski">
            <div class="form-error" id="nameError">Proszƒô podaƒá imiƒô i nazwisko</div>
          </div>

          <div style="margin-top:10px;">
            <label for="phone">Telefon *</label>
            <input id="phone" type="tel" required placeholder="+48 600 000 000">
            <div class="form-error" id="phoneError">Proszƒô podaƒá poprawny numer telefonu</div>
          </div>

          <div style="margin-top:10px;">
            <label for="email">Email *</label>
            <input id="email" type="email" required placeholder="twoj@email.pl">
            <div class="form-error" id="emailError">Proszƒô podaƒá poprawny adres email</div>
          </div>

          <div class="form-row" style="margin-top:10px;">
            <div class="col">
              <label for="from">SkƒÖd (miasto/adres) *</label>
              <input id="from" type="text" required placeholder="Pozna≈Ñ, ul. ≈öwiƒôta 1">
              <div class="form-error" id="fromError">Proszƒô podaƒá miejsce odbioru</div>
            </div>
            <div class="col">
              <label for="to">DokƒÖd (miasto/adres) *</label>
              <input id="to" type="text" required placeholder="Berlin, dworzec g≈Ç√≥wny">
              <div class="form-error" id="toError">Proszƒô podaƒá miejsce docelowe</div>
            </div>
          </div>

          <div class="form-row" style="margin-top:10px;">
            <div class="col">
              <label for="date">Data i godzina *</label>
              <input id="date" type="datetime-local" required>
              <div class="form-error" id="dateError">Proszƒô wybraƒá datƒô i godzinƒô</div>
            </div>
            <div class="col">
              <label for="people">Liczba os√≥b *</label>
              <input id="people" type="number" value="1" min="1" max="8" required>
              <div class="form-error" id="peopleError">Proszƒô podaƒá liczbƒô os√≥b (1-8)</div>
            </div>
          </div>

          <div style="margin-top:10px;">
            <label for="notes">Uwagi (baga≈º, dzieci, specjalne potrzeby...)</label>
            <textarea id="notes" placeholder="Np. 2 du≈ºe walizki, fotelik dzieciƒôcy..."></textarea>
          </div>

          <div style="margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <button type="submit" class="submit" id="submitBtn">
              Wy≈õlij rezerwacjƒô
            </button>
            <div class="muted" id="formStatus"></div>
          </div>

          <p class="muted" style="margin-top:10px;">
            ‚úÖ Po wys≈Çaniu formularza rezerwacja zostanie natychmiast wys≈Çana na email Mariusza<br>
            üìû Mariusz skontaktuje siƒô z TobƒÖ w celu potwierdzenia
          </p>
        </form>
      </div>

      <!-- Opinie -->
      <div id="opinie" class="card" style="margin-top:18px;">
        <h2>Opinie klient√≥w</h2>
        <div class="opinie-wrap">
          <div id="opiniaText" class="opinie">≈Åadowanie opinii...</div>
          <div class="chip">≈örednia: 4.9/5</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Sidebar -->
    <aside>
      <div class="card">
        <h2 id="kierowca">O kierowcy</h2>
        <p><strong>Mariusz "Maniek" Krawczyk</strong> ‚Äî w≈Ça≈õciciel firmy z 12-letnim do≈õwiadczeniem. Specjalizacja w trasach miƒôdzynarodowych PL‚ÜîDE/NL/BE. Certyfikowany kierowca z kursem pierwszej pomocy.</p>
        
        <div class="contact-info" style="margin: 15px 0; padding: 12px;">
          <div style="text-align: center;">
            <div style="font-weight: bold; color: var(--accent); margin-bottom: 5px;">W≈Ça≈õciciel</div>
            <div>Mariusz Krawczyk</div>
            <div style="font-size: 12px; color: var(--muted); margin-top: 5px;">
              Tel: +48 575 686 277<br>
              Email: mariusz.krawczyk7.88@gmail.com
            </div>
          </div>
        </div>
        
        <div style="margin-top:12px;" class="icons-row">
          <div class="icon-box"><div class="icon-emoji">üõ°Ô∏è</div><div class="small">Bezpiecze≈Ñstwo</div></div>
          <div class="icon-box"><div class="icon-emoji">üìç</div><div class="small">GPS / ≈öledzenie</div></div>
          <div class="icon-box"><div class="icon-emoji">üöò</div><div class="small">Komfort</div></div>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <h2 id="bezpieczenstwo">Bezpiecze≈Ñstwo</h2>
        <ul style="margin:0 0 0 18px;">
          <li>Regularne przeglƒÖdy techniczne</li>
          <li>Systemy ABS / ESP</li>
          <li>Kierowca z certyfikatem i do≈õwiadczeniem</li>
          <li>Auto dezynfekowane i czyste</li>
          <li>Pe≈Çne ubezpieczenie OC/AC + NNW</li>
        </ul>
      </div>

      <div class="card" style="margin-top:14px;">
        <div class="panel-title">
          <h2>Panel kierowcy</h2>
          <span class="small muted">Dostƒôp lokalny</span>
        </div>
        <p class="small muted">Kierowca widzi rezerwacje po zalogowaniu (has≈Ço). Has≈Ço ustawione w tej stronie to: <strong><span id="secretPlaceholder">ManiekManiek</span></strong></p>
        <button class="btn primary" id="openPanelMobile">Otw√≥rz Panel</button>

        <div id="panelArea" style="display:none; margin-top:12px;">
          <div id="welcomeMessage" class="success-message hidden">
            Cze≈õƒá Mariusz! Witaj w panelu kierowcy.
          </div>
          <div style="display:flex; gap:8px; align-items:center; margin-bottom:6px; flex-wrap:wrap;">
            <input id="panelPass" type="password" placeholder="Wprowad≈∫ has≈Ço" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06); min-width:150px;">
            <button id="panelLogin" class="btn">Zaloguj</button>
          </div>

          <div id="reservationsList" style="margin-top:12px;"></div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <button id="exportCsv" class="btn ghost">Eksportuj CSV</button>
            <button id="clearAll" class="btn ghost" title="Usu≈Ñ wszystkie lokalne rezerwacje">Usu≈Ñ</button>
          </div>
        </div>
      </div>
    </aside>
  </div>
</main>

<footer>
  <div class="container">
    <div class="small">¬© <span id="curYear"></span> Maniek ‚Äî Pewny Przew√≥z | Mariusz Krawczyk | Tel: +48 575 686 277 | Email: mariusz.krawczyk7.88@gmail.com</div>
  </div>
</footer>

<div class="ribbon">Zaufany przewo≈∫nik</div>

<script>
// =========================
// PROSTA WERSJA - WYSY≈ÅANIE EMAILA PRZEZ FORMULARZ KONTAKTOWY
// =========================

// --- podstawowe ustawienia ---
document.getElementById('curYear').textContent = new Date().getFullYear();
const SECRET_PASS = 'ManiekManiek';

// --- DANE W≈ÅA≈öCICIELA ---
const OWNER_EMAIL = 'mariusz.krawczyk7.88@gmail.com';

// --- lokalne przechowywanie rezerwacji ---
const STORAGE_KEY = 'maniek_reservations_v1';

function loadReservations(){
  try {
    const data = localStorage.getItem(STORAGE_KEY);
    return data ? JSON.parse(data) : [];
  } catch(e){ return []; }
}

function saveReservations(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

// --- Funkcja wysy≈Çania emaila ---
function sendBookingEmail(bookingData) {
  const subject = `Nowa rezerwacja - ${bookingData.name}`;
  
  // Tworzymy tabelkƒô w HTML dla emaila
  const emailBody = `
Nowa rezerwacja przejazdu:

<table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; font-family: Arial, sans-serif;">
<tr><td><b>Klient:</b></td><td>${bookingData.name}</td></tr>
<tr><td><b>Telefon:</b></td><td>${bookingData.phone}</td></tr>
<tr><td><b>Email:</b></td><td>${bookingData.email}</td></tr>
<tr><td><b>Trasa:</b></td><td>${bookingData.from} ‚Üí ${bookingData.to}</td></tr>
<tr><td><b>Data i godzina:</b></td><td>${new Date(bookingData.date).toLocaleString('pl-PL')}</td></tr>
<tr><td><b>Liczba os√≥b:</b></td><td>${bookingData.people}</td></tr>
<tr><td><b>Uwagi:</b></td><td>${bookingData.notes || 'Brak uwag'}</td></tr>
<tr><td><b>Data rezerwacji:</b></td><td>${new Date().toLocaleString('pl-PL')}</td></tr>
</table>

---
Wiadomo≈õƒá wys≈Çana ze strony Maniek - Pewny Przew√≥z
  `.trim();

  // Tworzymy link mailto
  const mailtoLink = `mailto:${OWNER_EMAIL}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
  
  // Otwieramy klienta pocztowego
  window.location.href = mailtoLink;
  
  return true;
}

// --- Opinie rotator ---
const opinie = [
  "‚≠ê ‚ÄûMariusz to kierowca jak z≈Çoto! Spok√≥j i pe≈Çna kultura.‚Äù",
  "‚≠ê ‚ÄûJecha≈Çem do Niemiec ‚Äî zero stresu, pe≈Çen komfort. Polecam!‚Äù",
  "‚≠ê ‚ÄûBezpiecznie, czysto i zawsze na czas. Mariusz to profesjonalista!‚Äù",
  "‚≠ê ‚ÄûManiek to kierowca, kt√≥ry naprawdƒô dba o ludzi i ich bezpiecze≈Ñstwo.‚Äù"
];
let opinIndex = 0;
function showOpinion(){ 
  document.getElementById('opiniaText').textContent = opinie[opinIndex]; 
  opinIndex=(opinIndex+1)%opinie.length; 
}
showOpinion(); 
setInterval(showOpinion,4500);

// =========================
// WALIDACJA I WYSY≈ÅANIE FORMULARZA
// =========================

// --- Walidacja formularza ---
function validateForm() {
  let isValid = true;
  
  // Reset errors
  document.querySelectorAll('.form-error').forEach(el => {
    el.style.display = 'none';
  });
  
  // Name validation
  const name = document.getElementById('name').value.trim();
  if (!name) {
    document.getElementById('nameError').style.display = 'block';
    isValid = false;
  }
  
  // Phone validation
  const phone = document.getElementById('phone').value.trim();
  const phoneRegex = /^[\+]?[0-9\s\-\(\)]{9,}$/;
  if (!phone || !phoneRegex.test(phone)) {
    document.getElementById('phoneError').style.display = 'block';
    isValid = false;
  }
  
  // Email validation (required)
  const email = document.getElementById('email').value.trim();
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || !emailRegex.test(email)) {
    document.getElementById('emailError').style.display = 'block';
    isValid = false;
  }
  
  // From validation
  const from = document.getElementById('from').value.trim();
  if (!from) {
    document.getElementById('fromError').style.display = 'block';
    isValid = false;
  }
  
  // To validation
  const to = document.getElementById('to').value.trim();
  if (!to) {
    document.getElementById('toError').style.display = 'block';
    isValid = false;
  }
  
  // Date validation
  const date = document.getElementById('date').value;
  if (!date) {
    document.getElementById('dateError').style.display = 'block';
    isValid = false;
  }
  
  // People validation
  const people = document.getElementById('people').value;
  if (!people || people < 1 || people > 8) {
    document.getElementById('peopleError').style.display = 'block';
    isValid = false;
  }
  
  return isValid;
}

// --- Obs≈Çuga formularza ---
const form = document.getElementById('bookingForm');
const formStatus = document.getElementById('formStatus');

form.addEventListener('submit', function(e){
  e.preventDefault();
  
  if (!validateForm()) {
    formStatus.textContent = 'Proszƒô poprawiƒá b≈Çƒôdy w formularzu.';
    formStatus.style.color = '#ff6b6b';
    setTimeout(()=>formStatus.textContent='','3500');
    return;
  }
  
  const r = {
    id: 'r_' + Date.now(),
    name: document.getElementById('name').value.trim(),
    phone: document.getElementById('phone').value.trim(),
    email: document.getElementById('email').value.trim(),
    from: document.getElementById('from').value.trim(),
    to: document.getElementById('to').value.trim(),
    date: document.getElementById('date').value,
    people: document.getElementById('people').value,
    notes: document.getElementById('notes').value.trim(),
    status: 'pending',
    created_at: new Date().toISOString()
  };

  // Zapisujemy lokalnie
  const arr = loadReservations();
  arr.unshift(r);
  saveReservations(arr);

  // WYSY≈ÅAMY EMAIL
  const emailSent = sendBookingEmail(r);

  if (emailSent) {
    // Pokazujemy sukces
    document.getElementById('emailSuccess').style.display = 'block';
    formStatus.textContent = 'Otwieram klienta pocztowego...';
    formStatus.style.color = '#4CAF50';
    
    // Reset formularza po 2 sekundach
    setTimeout(() => {
      form.reset();
      formStatus.textContent = '';
      document.getElementById('emailSuccess').style.display = 'none';
    }, 2000);
  }

  renderReservationsTable(); 
});

// =========================
// PANEL KIEROWCY
// =========================

const panelArea = document.getElementById('panelArea');
const panelLoginBtn = document.getElementById('panelLogin');
const panelPassInput = document.getElementById('panelPass');
const openPanelBtn = document.getElementById('openPanelBtn');
const openPanelMobile = document.getElementById('openPanelMobile');
const reservationsList = document.getElementById('reservationsList');
const welcomeMessage = document.getElementById('welcomeMessage');

let isLoggedIn = false;

function showPanelUI(){
  panelArea.style.display='block';
  document.getElementById('panelPass').focus();
}

openPanelBtn.addEventListener('click', ()=>{ 
  showPanelUI(); 
  window.scrollTo({top:0,behavior:'smooth'}); 
});

openPanelMobile.addEventListener('click', ()=>{ 
  showPanelUI(); 
  window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'}); 
});

panelLoginBtn.addEventListener('click', ()=> {
  const pass = panelPassInput.value || '';
  if(pass === SECRET_PASS){
    isLoggedIn = true;
    document.getElementById('panelPass').value = '';
    renderReservationsTable();
    document.getElementById('panelPass').placeholder = 'Zalogowano';
    panelLoginBtn.textContent = 'Od≈õwie≈º';
    welcomeMessage.textContent = `Cze≈õƒá Mariusz! Witaj w panelu kierowcy.`;
    welcomeMessage.classList.remove('hidden');
  } else {
    alert('B≈Çƒôdne has≈Ço.');
  }
});

function renderReservationsTable(){
  const arr = loadReservations();
  if(arr.length===0){
    reservationsList.innerHTML = '<div class="small muted">Brak rezerwacji.</div>';
    return;
  }

  let html = '<div style="overflow:auto;"><table><thead><tr><th>Imiƒô</th><th>Tel</th><th>Trasa</th><th>Data</th><th>Os√≥b</th><th>Uwagi</th><th>Status</th></tr></thead><tbody>';
  arr.forEach(r=>{
    html += `<tr id="${r.id}"><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.phone)}</td><td>${escapeHtml(r.from)} ‚Üí ${escapeHtml(r.to)}</td><td>${new Date(r.date).toLocaleString()}</td><td>${escapeHtml(r.people)}</td><td>${escapeHtml(r.notes)}</td><td><select data-id="${r.id}" onchange="changeStatus(this)"><option ${r.status==='pending'?'selected':''}>pending</option><option ${r.status==='accepted'?'selected':''}>accepted</option><option ${r.status==='rejected'?'selected':''}>rejected</option></select></td></tr>`;
  });
  html += '</tbody></table></div>';
  reservationsList.innerHTML = html;
}

window.changeStatus = function(sel){
  const id = sel.dataset.id;
  const newStatus = sel.value;
  let arr = loadReservations();
  arr = arr.map(r => r.id===id ? Object.assign({}, r, {status:newStatus}) : r);
  saveReservations(arr);
  renderReservationsTable();
};

document.getElementById('exportCsv').addEventListener('click', ()=> {
  const arr = loadReservations();
  if(arr.length===0){ alert('Brak rezerwacji do eksportu.'); return; }
  const header = ['id','name','phone','email','from','to','date','people','notes','status','created_at'];
  const rows = arr.map(r => header.map(h => `"${(r[h]||'').toString().replace(/"/g,'""')}"`).join(','));
  const csv = [header.join(','), ...rows].join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; 
  a.download = 'rezerwacje_maniek.csv'; 
  document.body.appendChild(a); 
  a.click(); 
  a.remove();
  URL.revokeObjectURL(url);
});

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('UsunƒÖƒá wszystkie lokalne rezerwacje?')) return;
  localStorage.removeItem(STORAGE_KEY);
  renderReservationsTable();
});

// Inicjalizacja
renderReservationsTable();

function escapeHtml(s=''){ 
  return String(s).replace(/[&<>"']/g, function(m){ 
    return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; 
  }); 
}
</script>

</body>
</html>
